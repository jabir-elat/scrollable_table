{
  "version": 3,
  "sources": ["../../../../../apps/scrollable_table/scrollable_table/public/js/grid_row_form.js", "../../../../../apps/scrollable_table/scrollable_table/public/js/grid_row.js", "../../../../../apps/scrollable_table/scrollable_table/public/js/grid_pagination.js", "../../../../../apps/scrollable_table/scrollable_table/public/js/grid.js", "../../../../../apps/scrollable_table/scrollable_table/public/js/updated_gridview.bundle.js"],
  "sourcesContent": ["export default class GridRowForm {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.wrapper = $('<div class=\"form-in-grid\"></div>').appendTo(this.row.wrapper);\n\t}\n\trender() {\n\t\tvar me = this;\n\t\tthis.make_form();\n\t\tthis.form_area.empty();\n\t\tfrappe.utils.scroll_to(0, false, 0, this.wrapper.find(\".grid-form-body\"));\n\n\t\tthis.layout = new frappe.ui.form.Layout({\n\t\t\tfields: this.row.docfields,\n\t\t\tbody: this.form_area,\n\t\t\tno_submit_on_enter: true,\n\t\t\tfrm: this.row.frm,\n\t\t\tgrid: this.row.grid,\n\t\t\tgrid_row: this.row,\n\t\t\tgrid_row_form: this,\n\t\t});\n\t\tthis.layout.make();\n\n\t\tthis.fields = this.layout.fields;\n\t\tthis.fields_dict = this.layout.fields_dict;\n\n\t\tthis.layout.refresh(this.row.doc);\n\n\t\t// copy get_query to fields\n\t\tfor (var fieldname in this.row.grid.fieldinfo || {}) {\n\t\t\tvar fi = this.row.grid.fieldinfo[fieldname];\n\t\t\t$.extend(me.fields_dict[fieldname], fi);\n\t\t}\n\n\t\tthis.toggle_add_delete_button_display(this.wrapper);\n\n\t\tthis.row.grid.open_grid_row = this;\n\n\t\tthis.set_focus();\n\t}\n\tmake_form() {\n\t\tif (!this.form_area) {\n\t\t\tlet template = `<div class=\"grid-form-heading\">\n\t\t\t\t<div class=\"toolbar grid-header-toolbar\">\n\t\t\t\t\t<span class=\"panel-title\">\n\t\t\t\t\t\t${__(\"Editing Row\")} #<span class=\"grid-form-row-index\"></span></span>\n\t\t\t\t\t<span class=\"row-actions\">\n\t\t\t\t\t\t<button class=\"btn btn-secondary btn-sm pull-right grid-collapse-row\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"down\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class=\"btn btn-secondary btn-sm pull-right grid-move-row hidden-xs\">\n\t\t\t\t\t\t\t${__(\"Move\")}</button>\n\t\t\t\t\t\t<button class=\"btn btn-secondary btn-sm pull-right grid-duplicate-row hidden-xs\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"duplicate\")}\n\t\t\t\t\t\t\t${__(\"Duplicate\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class=\"btn btn-secondary btn-sm pull-right grid-insert-row hidden-xs\">\n\t\t\t\t\t\t\t${__(\"Insert Above\")}</button>\n\t\t\t\t\t\t<button class=\"btn btn-secondary btn-sm pull-right grid-insert-row-below hidden-xs\">\n\t\t\t\t\t\t\t${__(\"Insert Below\")}</button>\n\t\t\t\t\t\t<button class=\"btn btn-danger btn-sm pull-right grid-delete-row\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"delete\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"grid-form-body\">\n\t\t\t\t<div class=\"form-area\"></div>\n\t\t\t\t<div class=\"grid-footer-toolbar hidden-xs flex justify-between\">\n\t\t\t\t\t<div class=\"grid-shortcuts\">\n\t\t\t\t\t\t<span> ${frappe.utils.icon(\"keyboard\", \"md\")} </span>\n\t\t\t\t\t\t<span class=\"text-medium\"> ${__(\"Shortcuts\")}: </span>\n\t\t\t\t\t\t<kbd>${__(\"Ctrl + Up\")}</kbd> . <kbd>${__(\"Ctrl + Down\")}</kbd> . <kbd>${__(\"ESC\")}</kbd>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"row-actions\">\n\t\t\t\t\t\t<button class=\"btn btn-secondary btn-sm pull-right grid-append-row\">\n\t\t\t\t\t\t\t${__(\"Insert Below\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\t\t$(template).appendTo(this.wrapper);\n\t\t\tthis.form_area = this.wrapper.find(\".form-area\");\n\t\t\tthis.row.set_row_index();\n\t\t\tthis.set_form_events();\n\t\t}\n\t}\n\tset_form_events() {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".grid-delete-row\").on(\"click\", function () {\n\t\t\tme.row.remove();\n\t\t\treturn false;\n\t\t});\n\t\tthis.wrapper.find(\".grid-insert-row\").on(\"click\", function () {\n\t\t\tme.row.insert(true);\n\t\t\treturn false;\n\t\t});\n\t\tthis.wrapper.find(\".grid-insert-row-below\").on(\"click\", function () {\n\t\t\tme.row.insert(true, true);\n\t\t\treturn false;\n\t\t});\n\t\tthis.wrapper.find(\".grid-duplicate-row\").on(\"click\", function () {\n\t\t\tme.row.insert(true, true, true);\n\t\t\treturn false;\n\t\t});\n\t\tthis.wrapper.find(\".grid-move-row\").on(\"click\", function () {\n\t\t\tme.row.move();\n\t\t\treturn false;\n\t\t});\n\t\tthis.wrapper.find(\".grid-append-row\").on(\"click\", function () {\n\t\t\tme.row.toggle_view(false);\n\t\t\tme.row.grid.add_new_row(me.row.doc.idx + 1, null, true);\n\t\t\treturn false;\n\t\t});\n\t\tthis.wrapper.find(\".grid-form-heading, .grid-footer-toolbar\").on(\"click\", function () {\n\t\t\tme.row.toggle_view();\n\t\t\treturn false;\n\t\t});\n\t}\n\ttoggle_add_delete_button_display($parent) {\n\t\t$parent.find(\".row-actions, .grid-append-row\").toggle(this.row.grid.is_editable());\n\t}\n\trefresh_field(fieldname) {\n\t\tconst field = this.fields_dict[fieldname];\n\t\tif (!field) return;\n\n\t\tfield.docname = this.row.doc.name;\n\t\tfield.refresh();\n\t\tthis.layout && this.layout.refresh_dependency();\n\t}\n\tset_focus() {\n\t\t// wait for animation and then focus on the first row\n\t\tvar me = this;\n\t\tsetTimeout(function () {\n\t\t\tif ((me.row.frm && me.row.frm.doc.docstatus === 0) || !me.row.frm) {\n\t\t\t\tvar first = me.form_area.find(\"input:first\");\n\t\t\t\tif (\n\t\t\t\t\tfirst.length &&\n\t\t\t\t\t![\"Date\", \"Datetime\", \"Time\"].includes(first.attr(\"data-fieldtype\"))\n\t\t\t\t) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfirst.get(0).focus();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t//\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, 500);\n\t}\n}", "import GridRowForm from \"./grid_row_form\";\n\nexport default class GridRow {\n\tconstructor(opts) {\n\t\tthis.on_grid_fields_dict = {};\n\t\tthis.on_grid_fields = [];\n\t\t$.extend(this, opts);\n\t\tthis.set_docfields();\n\t\tthis.columns = {};\n\t\tthis.columns_list = [];\n\t\tthis.row_check_html = '<input type=\"checkbox\" class=\"grid-row-check\">';\n\t\tthis.make();\n\t}\n\tmake() {\n\t\tlet me = this;\n\t\tlet render_row = true;\n\n\t\tthis.wrapper = $('<div class=\"grid-row\"></div>');\n\t\tthis.row = $('<div class=\"data-row row m-0\"></div>')\n\t\t\t.appendTo(this.wrapper)\n\t\t\t.on(\"click\", function (e) {\n\t\t\t\tif (\n\t\t\t\t\t$(e.target).hasClass(\"grid-row-check\") ||\n\t\t\t\t\t$(e.target).hasClass(\"row-index\") ||\n\t\t\t\t\t$(e.target).parent().hasClass(\"row-index\")\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (me.grid.allow_on_grid_editing() && me.grid.is_editable()) {\n\t\t\t\t\t// pass\n\t\t\t\t} else {\n\t\t\t\t\tme.toggle_view();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\tif (this.grid.template && !this.grid.meta.editable_grid) {\n\t\t\tthis.render_template();\n\t\t} else {\n\t\t\trender_row = this.render_row();\n\t\t}\n\n\t\tif (!render_row) return;\n\n\t\tthis.set_data();\n\t\tthis.wrapper.appendTo(this.parent);\n\t}\n\n\tset_docfields(update = false) {\n\t\tif (this.doc && this.parent_df.options) {\n\t\t\tfrappe.meta.make_docfield_copy_for(\n\t\t\t\tthis.parent_df.options,\n\t\t\t\tthis.doc.name,\n\t\t\t\tthis.docfields\n\t\t\t);\n\t\t\tconst docfields = frappe.meta.get_docfields(this.parent_df.options, this.doc.name);\n\t\t\tif (update) {\n\t\t\t\t// to maintain references\n\t\t\t\tthis.docfields.forEach((df) => {\n\t\t\t\t\tObject.assign(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tdocfields.find((d) => d.fieldname === df.fieldname)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.docfields = docfields;\n\t\t\t}\n\t\t}\n\t}\n\n\tset_data() {\n\t\tthis.wrapper.data({\n\t\t\tgrid_row: this,\n\t\t\tdoc: this.doc || \"\",\n\t\t});\n\t}\n\tset_row_index() {\n\t\tif (this.doc) {\n\t\t\tthis.wrapper\n\t\t\t\t.attr(\"data-name\", this.doc.name)\n\t\t\t\t.attr(\"data-idx\", this.doc.idx)\n\t\t\t\t.find(\".row-index span, .grid-form-row-index\")\n\t\t\t\t.html(this.doc.idx);\n\t\t}\n\t}\n\tselect(checked) {\n\t\tthis.doc.__checked = checked ? 1 : 0;\n\t}\n\trefresh_check() {\n\t\tthis.wrapper\n\t\t\t.find(\".grid-row-check\")\n\t\t\t.prop(\"checked\", this.doc ? !!this.doc.__checked : false);\n\t\tthis.grid.debounced_refresh_remove_rows_button();\n\t}\n\tremove() {\n\t\tvar me = this;\n\t\tif (this.grid.is_editable()) {\n\t\t\tif (this.get_open_form()) {\n\t\t\t\tthis.hide_form();\n\t\t\t}\n\t\t\tif (this.frm) {\n\t\t\t\tfrappe\n\t\t\t\t\t.run_serially([\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\treturn this.frm.script_manager.trigger(\n\t\t\t\t\t\t\t\t\"before_\" + this.grid.df.fieldname + \"_remove\",\n\t\t\t\t\t\t\t\tthis.doc.doctype,\n\t\t\t\t\t\t\t\tthis.doc.name\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tfrappe.model.clear_doc(this.doc.doctype, this.doc.name);\n\n\t\t\t\t\t\t\tthis.frm.script_manager.trigger(\n\t\t\t\t\t\t\t\tthis.grid.df.fieldname + \"_remove\",\n\t\t\t\t\t\t\t\tthis.doc.doctype,\n\t\t\t\t\t\t\t\tthis.doc.name\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.frm.dirty();\n\t\t\t\t\t\t\tthis.grid.refresh();\n\t\t\t\t\t\t},\n\t\t\t\t\t])\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\t// aborted\n\t\t\t\t\t\tconsole.trace(e);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet data = null;\n\t\t\t\tif (this.grid.df.get_data) {\n\t\t\t\t\tdata = this.grid.df.get_data();\n\t\t\t\t} else {\n\t\t\t\t\tdata = this.grid.df.data;\n\t\t\t\t}\n\n\t\t\t\tconst index = data.findIndex((d) => d.name === me.doc.name);\n\n\t\t\t\tif (index > -1) {\n\t\t\t\t\t// mutate array directly,\n\t\t\t\t\t// else the object reference will be lost\n\t\t\t\t\tdata.splice(index, 1);\n\t\t\t\t}\n\t\t\t\t// remap idxs\n\t\t\t\tdata.forEach(function (d, i) {\n\t\t\t\t\td.idx = i + 1;\n\t\t\t\t});\n\n\t\t\t\tthis.grid.refresh();\n\t\t\t}\n\t\t}\n\t}\n\tinsert(show, below, duplicate) {\n\t\tvar idx = this.doc.idx;\n\t\tvar copy_doc = duplicate ? this.doc : null;\n\t\tif (below) idx++;\n\t\tthis.toggle_view(false);\n\t\tthis.grid.add_new_row(idx, null, show, copy_doc);\n\t}\n\tmove() {\n\t\t// promopt the user where they want to move this row\n\t\tvar me = this;\n\t\tfrappe.prompt(\n\t\t\t{\n\t\t\t\tfieldname: \"move_to\",\n\t\t\t\tlabel: __(\"Move to Row Number\"),\n\t\t\t\tfieldtype: \"Int\",\n\t\t\t\treqd: 1,\n\t\t\t\tdefault: this.doc.idx,\n\t\t\t},\n\t\t\tfunction (values) {\n\t\t\t\tif (me.doc._sortable === false) {\n\t\t\t\t\tfrappe.msgprint(__(\"Cannot move row\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// renumber and refresh\n\t\t\t\tlet data = me.grid.get_data();\n\t\t\t\tdata.move(me.doc.idx - 1, values.move_to - 1);\n\t\t\t\tme.frm.dirty();\n\n\t\t\t\t// renum idx\n\t\t\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t\t\tdata[i].idx = i + 1;\n\t\t\t\t}\n\n\t\t\t\tme.toggle_view(false);\n\t\t\t\tme.grid.refresh();\n\t\t\t\t$(me.frm.wrapper).trigger(\"grid-move-row\", [me.frm, me]);\n\t\t\t},\n\t\t\t__(\"Move To\"),\n\t\t\t\"Update\"\n\t\t);\n\t}\n\trefresh() {\n\t\t// update docfields for new record\n\t\tif (this.frm && this.doc && this.doc.__islocal) {\n\t\t\tthis.set_docfields(true);\n\t\t}\n\n\t\tif (this.frm && this.doc) {\n\t\t\tthis.doc = locals[this.doc.doctype][this.doc.name];\n\t\t}\n\n\t\tif (this.grid.template && !this.grid.meta.editable_grid) {\n\t\t\tthis.render_template();\n\t\t} else {\n\t\t\tthis.render_row(true);\n\t\t}\n\n\t\t// refresh form fields\n\t\tif (this.grid_form) {\n\t\t\tthis.grid_form.layout && this.grid_form.layout.refresh(this.doc);\n\t\t}\n\t}\n\trender_template() {\n\t\tthis.set_row_index();\n\n\t\tif (this.row_display) {\n\t\t\tthis.row_display.remove();\n\t\t}\n\n\t\t// row index\n\t\tif (!this.row_index) {\n\t\t\tthis.row_index = $(\n\t\t\t\t`<div class=\"template-row-index\">${this.row_check_html}<span></span></div>`\n\t\t\t).appendTo(this.row);\n\t\t}\n\n\t\tif (this.doc) {\n\t\t\tthis.row_index.find(\"span\").html(this.doc.idx);\n\t\t}\n\n\t\tthis.row_display = $('<div class=\"row-data sortable-handle template-row\"></div>')\n\t\t\t.appendTo(this.row)\n\t\t\t.html(\n\t\t\t\tfrappe.render(this.grid.template, {\n\t\t\t\t\tdoc: this.doc ? frappe.get_format_helper(this.doc) : null,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\trow: this,\n\t\t\t\t})\n\t\t\t);\n\t}\n\trender_row(refresh) {\n\t\tif (this.show_search && !this.show_search_row()) return;\n\n\t\tlet me = this;\n\t\tthis.set_row_index();\n\n\t\t// index (1, 2, 3 etc)\n\t\tif (!this.row_index && !this.show_search) {\n\t\t\tconst txt = this.doc\n\t\t\t\t? this.doc.idx\n\t\t\t\t: __(\"No.\", null, \"Title of the 'row number' column\");\n\n\t\t\tthis.row_check = $(\n\t\t\t\t`<div class=\"row-check sortable-handle col\">\n\t\t\t\t\t${this.row_check_html}\n\t\t\t\t</div>`\n\t\t\t).appendTo(this.row);\n\n\t\t\tthis.row_index = $(\n\t\t\t\t`<div class=\"row-index sortable-handle grid-static-col col\">\n\t\t\t\t\t<span>${txt}</span>\n\t\t\t\t</div>`\n\t\t\t)\n\t\t\t\t.appendTo(this.row)\n\t\t\t\t.on(\"click\", function (e) {\n\t\t\t\t\tif (!$(e.target).hasClass(\"grid-row-check\")) {\n\t\t\t\t\t\tme.toggle_view();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else if (this.show_search) {\n\t\t\tthis.row_check = $(`\n\t\t\t\t<div class=\"row-check col search\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control input-xs text-center invisible\">\n\t\t\t\t</div>`).appendTo(this.row);\n\n\t\t\tthis.row_index = $(\n\t\t\t\t`<div class=\"row-index col search\">\n\t\t\t\t\t<input type=\"text\" class=\"form-control input-xs text-center\" >\n\t\t\t\t\t<span style=\"width: 33px;\" class=\"d-block\"></span>\n\t\t\t\t</div>`\n\t\t\t).appendTo(this.row);\n\n\t\t\tthis.row_index.find(\"input\").on(\n\t\t\t\t\"keyup\",\n\t\t\t\tfrappe.utils.debounce((e) => {\n\t\t\t\t\tlet df = {\n\t\t\t\t\t\tfieldtype: \"Sr No\",\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.grid.filter[\"row-index\"] = {\n\t\t\t\t\t\tdf: df,\n\t\t\t\t\t\tvalue: e.target.value,\n\t\t\t\t\t};\n\n\t\t\t\t\tif (e.target.value == \"\") {\n\t\t\t\t\t\tdelete this.grid.filter[\"row-index\"];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.grid.grid_sortable.option(\n\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\tObject.keys(this.grid.filter).length !== 0\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.grid.prevent_build = true;\n\t\t\t\t\tme.grid.refresh();\n\t\t\t\t\tthis.grid.prevent_build = false;\n\t\t\t\t}, 500)\n\t\t\t);\n\t\t\tfrappe.utils.only_allow_num_decimal(this.row_index.find(\"input\"));\n\t\t}\n\n\t\tthis.setup_columns();\n\t\tthis.add_open_form_button();\n\t\tthis.add_column_configure_button();\n\t\tthis.refresh_check();\n\n\t\tif (this.frm && this.doc) {\n\t\t\t$(this.frm.wrapper).trigger(\"grid-row-render\", [this]);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tmake_editable() {\n\t\tthis.row.toggleClass(\"editable-row\", this.grid.is_editable());\n\t}\n\n\tis_too_small() {\n\t\treturn this.row.width() ? this.row.width() < 300 : false;\n\t}\n\n\tadd_open_form_button() {\n\t\tvar me = this;\n\t\tif (this.doc && !this.grid.df.in_place_edit) {\n\t\t\t// remove row\n\t\t\tif (!this.open_form_button) {\n\t\t\t\tthis.open_form_button = $('<div class=\"col\"></div>').appendTo(this.row);\n\n\t\t\t\tif (!this.configure_columns) {\n\t\t\t\t\tconst edit_msg = __(\"Edit\", \"\", \"Edit grid row\");\n\t\t\t\t\tthis.open_form_button = $(`\n\t\t\t\t\t\t<div class=\"btn-open-row\" data-toggle=\"tooltip\" data-placement=\"right\" title=\"${edit_msg}\">\n\t\t\t\t\t\t\t<a>${frappe.utils.icon(\"edit\", \"xs\")}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`)\n\t\t\t\t\t\t.appendTo(this.open_form_button)\n\t\t\t\t\t\t.on(\"click\", function () {\n\t\t\t\t\t\t\tme.toggle_view();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tthis.open_form_button.tooltip({ delay: { show: 600, hide: 100 } });\n\t\t\t\t}\n\n\t\t\t\tif (this.is_too_small()) {\n\t\t\t\t\t// narrow\n\t\t\t\t\tthis.open_form_button.css({ \"margin-right\": \"-2px\" });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_column_configure_button() {\n\t\tif (this.grid.df.in_place_edit && !this.frm) return;\n\n\t\tif (this.configure_columns && this.frm) {\n\t\t\tthis.configure_columns_button = $(`\n\t\t\t\t<div class=\"col grid-static-col pointer\">\n\t\t\t\t\t<a>${frappe.utils.icon(\"setting-gear\", \"sm\", \"\", \"filter: opacity(0.5)\")}</a>\n\t\t\t\t</div>\n\t\t\t`)\n\t\t\t\t.appendTo(this.row)\n\t\t\t\t.on(\"click\", () => {\n\t\t\t\t\tthis.configure_dialog_for_columns_selector();\n\t\t\t\t});\n\t\t} else if (this.configure_columns && !this.frm) {\n\t\t\tthis.configure_columns_button = $(`\n\t\t\t\t<div class=\"col grid-static-col\"></div>\n\t\t\t`).appendTo(this.row);\n\t\t}\n\t}\n\n\tconfigure_dialog_for_columns_selector() {\n\t\tthis.grid_settings_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Configure Columns\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: \"fields_html\",\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.grid.setup_visible_columns();\n\t\tthis.setup_columns_for_dialog();\n\t\tthis.prepare_wrapper_for_columns();\n\t\tthis.render_selected_columns();\n\t\tthis.grid_settings_dialog.show();\n\n\t\t$(this.fields_html_wrapper)\n\t\t\t.find(\".add-new-fields\")\n\t\t\t.click(() => {\n\t\t\t\tthis.column_selector_for_dialog();\n\t\t\t});\n\n\t\tthis.grid_settings_dialog.set_primary_action(__(\"Update\"), () => {\n\t\t\tthis.columns = {};\n\t\t\tthis.update_user_settings_for_grid();\n\t\t\tthis.grid_settings_dialog.hide();\n\t\t\tthis.grid.handle_scroll_bar();\n\t\t});\n\n\t\tthis.grid_settings_dialog.set_secondary_action_label(__(\"Reset to default\"));\n\t\tthis.grid_settings_dialog.set_secondary_action(() => {\n\t\t\tthis.reset_user_settings_for_grid();\n\t\t\tthis.grid_settings_dialog.hide();\n\t\t\tthis.grid.handle_scroll_bar();\n\t\t});\n\t}\n\n\tsetup_columns_for_dialog() {\n\t\tthis.selected_columns_for_grid = [];\n\t\tthis.grid.visible_columns.forEach((row) => {\n\t\t\tthis.selected_columns_for_grid.push({\n\t\t\t\tfieldname: row[0].fieldname,\n\t\t\t\tcolumns: row[0].columns || row[0].colsize,\n\t\t\t});\n\t\t});\n\t}\n\n\tprepare_wrapper_for_columns() {\n\t\tthis.fields_html_wrapper = this.grid_settings_dialog.get_field(\"fields_html\").$wrapper[0];\n\n\t\t$(`\n\t\t\t<div class='form-group'>\n\t\t\t\t<div class='row' style='margin-bottom:10px;'>\n\t\t\t\t\t<div class='col-1'></div>\n\t\t\t\t\t<div class='col-6' style='padding-left:20px;'>\n\t\t\t\t\t\t${__(\"Fieldname\").bold()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='col-4'>\n\t\t\t\t\t\t${__(\"Column Width\").bold()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='col-1'></div>\n\t\t\t\t</div>\n\t\t\t\t<div class='control-input-wrapper selected-fields'>\n\t\t\t\t</div>\n\t\t\t\t<p class='help-box small text-muted'>\n\t\t\t\t\t<a class='add-new-fields text-muted'>\n\t\t\t\t\t\t+ ${__(\"Add / Remove Columns\")}\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`).appendTo(this.fields_html_wrapper);\n\t}\n\n\tcolumn_selector_for_dialog() {\n\t\tlet docfields = this.prepare_columns_for_dialog(\n\t\t\tthis.selected_columns_for_grid.map((field) => field.fieldname)\n\t\t);\n\n\t\tlet d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"{0} Fields\", [__(this.grid.doctype)]),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Select Fields\"),\n\t\t\t\t\tfieldtype: \"MultiCheck\",\n\t\t\t\t\tfieldname: \"fields\",\n\t\t\t\t\toptions: docfields,\n\t\t\t\t\tcolumns: 2,\n\t\t\t\t\tsort_options: false,\n\t\t\t\t},\n\t\t\t],\n\t\t\tsecondary_action_label: __(\"Select All\"),\n\t\t\tsecondary_action: () => this.select_all_columns(docfields),\n\t\t});\n\n\t\td.set_primary_action(__(\"Add\"), () => {\n\t\t\tlet selected_fields = d.get_values().fields;\n\t\t\tthis.selected_columns_for_grid = [];\n\t\t\tif (selected_fields) {\n\t\t\t\tselected_fields.forEach((selected_column) => {\n\t\t\t\t\tlet docfield = frappe.meta.get_docfield(this.grid.doctype, selected_column);\n\t\t\t\t\tthis.grid.update_default_colsize(docfield);\n\n\t\t\t\t\tthis.selected_columns_for_grid.push({\n\t\t\t\t\t\tfieldname: selected_column,\n\t\t\t\t\t\tcolumns: docfield.columns || docfield.colsize,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.render_selected_columns();\n\t\t\t\td.hide();\n\t\t\t}\n\t\t});\n\n\t\td.show();\n\t}\n\n\tselect_all_columns(docfields) {\n\t\tdocfields.forEach((docfield) => {\n\t\t\tif (docfield.checked) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$(`.checkbox.unit-checkbox input[type=\"checkbox\"][data-unit=\"${docfield.value}\"]`)\n\t\t\t\t.prop(\"checked\", true)\n\t\t\t\t.trigger(\"change\");\n\t\t});\n\t}\n\n\tprepare_columns_for_dialog(selected_fields) {\n\t\tlet fields = [];\n\n\t\tconst blocked_fields = frappe.model.no_value_type;\n\t\tconst always_allow = [\"Button\"];\n\n\t\tconst show_field = (f) => always_allow.includes(f) || !blocked_fields.includes(f);\n\n\t\t// First, add selected fields\n\t\tselected_fields.forEach((selectedField) => {\n\t\t\tconst selectedColumn = this.docfields.find(\n\t\t\t\t(column) => column.fieldname === selectedField\n\t\t\t);\n\t\t\tif (selectedColumn && !selectedColumn.hidden && show_field(selectedColumn.fieldtype)) {\n\t\t\t\tfields.push({\n\t\t\t\t\tlabel: __(selectedColumn.label, null, this.grid.doctype),\n\t\t\t\t\tvalue: selectedColumn.fieldname,\n\t\t\t\t\tchecked: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Then, add the rest of the fields\n\t\tthis.docfields.forEach((column) => {\n\t\t\tif (\n\t\t\t\t!selected_fields.includes(column.fieldname) &&\n\t\t\t\t!column.hidden &&\n\t\t\t\tshow_field(column.fieldtype)\n\t\t\t) {\n\t\t\t\tfields.push({\n\t\t\t\t\tlabel: __(column.label, null, this.grid.doctype),\n\t\t\t\t\tvalue: column.fieldname,\n\t\t\t\t\tchecked: false,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t}\n\n\trender_selected_columns() {\n\t\tlet fields = \"\";\n\t\tif (this.selected_columns_for_grid) {\n\t\t\tthis.selected_columns_for_grid.forEach((d) => {\n\t\t\t\tlet docfield = frappe.meta.get_docfield(this.grid.doctype, d.fieldname);\n\n\t\t\t\tfields += `\n\t\t\t\t\t<div class='control-input flex align-center form-control fields_order sortable-handle sortable'\n\t\t\t\t\t\tstyle='display: block; margin-bottom: 5px; padding: 0 8px; cursor: pointer; height: 32px;' data-fieldname='${\n\t\t\t\t\t\t\tdocfield.fieldname\n\t\t\t\t\t\t}'\n\t\t\t\t\t\tdata-label='${docfield.label}' data-type='${docfield.fieldtype}'>\n\n\t\t\t\t\t\t<div class='row'>\n\t\t\t\t\t\t\t<div class='col-1' style='padding-top: 4px;'>\n\t\t\t\t\t\t\t\t<a style='cursor: grabbing;'>${frappe.utils.icon(\"drag\", \"xs\")}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class='col-6' style='padding-top: 5px;'>\n\t\t\t\t\t\t\t\t${__(docfield.label, null, docfield.parent)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class='col-4' style='padding-top: 2px; margin-top:-2px;' title='${__(\"Columns\")}'>\n\t\t\t\t\t\t\t\t<input class='form-control column-width my-1 input-xs text-right'\n\t\t\t\t\t\t\t\tstyle='height: 24px; max-width: 80px; background: var(--bg-color);'\n\t\t\t\t\t\t\t\t\tvalue='${docfield.columns || cint(d.columns)}'\n\t\t\t\t\t\t\t\t\tdata-fieldname='${docfield.fieldname}' style='background-color: var(--modal-bg); display: inline'>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class='col-1' style='padding-top: 3px;'>\n\t\t\t\t\t\t\t\t<a class='text-muted remove-field' data-fieldname='${docfield.fieldname}'>\n\t\t\t\t\t\t\t\t\t<i class='fa fa-trash-o' aria-hidden='true'></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t});\n\t\t}\n\n\t\t$(this.fields_html_wrapper).find(\".selected-fields\").html(fields);\n\n\t\tthis.prepare_handler_for_sort();\n\t\tthis.select_on_focus();\n\t\tthis.update_column_width();\n\t\tthis.remove_selected_column();\n\t}\n\n\tprepare_handler_for_sort() {\n\t\tnew Sortable($(this.fields_html_wrapper).find(\".selected-fields\")[0], {\n\t\t\thandle: \".sortable-handle\",\n\t\t\tdraggable: \".sortable\",\n\t\t\tonUpdate: () => {\n\t\t\t\tthis.sort_columns();\n\t\t\t},\n\t\t});\n\t}\n\n\tsort_columns() {\n\t\tthis.selected_columns_for_grid = [];\n\n\t\tlet columns = $(this.fields_html_wrapper).find(\".fields_order\") || [];\n\t\tcolumns.each((idx) => {\n\t\t\tthis.selected_columns_for_grid.push({\n\t\t\t\tfieldname: $(columns[idx]).attr(\"data-fieldname\"),\n\t\t\t\tcolumns: cint($(columns[idx]).find(\".column-width\").attr(\"value\")),\n\t\t\t});\n\t\t});\n\t}\n\n\tselect_on_focus() {\n\t\t$(this.fields_html_wrapper)\n\t\t\t.find(\".column-width\")\n\t\t\t.click((event) => {\n\t\t\t\t$(event.target).select();\n\t\t\t});\n\t}\n\n\tupdate_column_width() {\n\t\t$(this.fields_html_wrapper)\n\t\t\t.find(\".column-width\")\n\t\t\t.change((event) => {\n\t\t\t\tif (cint(event.target.value) === 0) {\n\t\t\t\t\tevent.target.value = cint(event.target.defaultValue);\n\t\t\t\t\tfrappe.throw(__(\"Column width cannot be zero.\"));\n\t\t\t\t}\n\n\t\t\t\tthis.selected_columns_for_grid.forEach((row) => {\n\t\t\t\t\tif (row.fieldname === event.target.dataset.fieldname) {\n\t\t\t\t\t\trow.columns = cint(event.target.value);\n\t\t\t\t\t\tevent.target.defaultValue = cint(event.target.value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tremove_selected_column() {\n\t\t$(this.fields_html_wrapper)\n\t\t\t.find(\".remove-field\")\n\t\t\t.click((event) => {\n\t\t\t\tlet fieldname = event.currentTarget.dataset.fieldname;\n\t\t\t\tlet selected_columns_for_grid = this.selected_columns_for_grid.filter((row) => {\n\t\t\t\t\treturn row.fieldname !== fieldname;\n\t\t\t\t});\n\n\t\t\t\tif (selected_columns_for_grid && selected_columns_for_grid.length === 0) {\n\t\t\t\t\tfrappe.throw(__(\"At least one column is required to show in the grid.\"));\n\t\t\t\t}\n\n\t\t\t\tthis.selected_columns_for_grid = selected_columns_for_grid;\n\t\t\t\t$(this.fields_html_wrapper).find(`[data-fieldname=\"${fieldname}\"]`).remove();\n\t\t\t});\n\t}\n\n\tupdate_user_settings_for_grid() {\n\t\tif (!this.selected_columns_for_grid || !this.frm) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet value = {};\n\t\tvalue[this.grid.doctype] = this.selected_columns_for_grid;\n\t\tfrappe.model.user_settings.save(this.frm.doctype, \"GridView\", value).then((r) => {\n\t\t\tfrappe.model.user_settings[this.frm.doctype] = r.message || r;\n\t\t\tthis.grid.reset_grid();\n\t\t});\n\t}\n\n\treset_user_settings_for_grid() {\n\t\tfrappe.model.user_settings.save(this.frm.doctype, \"GridView\", null).then((r) => {\n\t\t\tfrappe.model.user_settings[this.frm.doctype] = r.message || r;\n\t\t\tthis.grid.reset_grid();\n\t\t});\n\t}\n\n\tsetup_columns() {\n\t\tthis.focus_set = false;\n\t\tthis.search_columns = {};\n\n\t\tthis.grid.setup_visible_columns();\n\t\tlet fields =\n\t\t\tthis.grid.user_defined_columns && this.grid.user_defined_columns.length > 0\n\t\t\t\t? this.grid.user_defined_columns\n\t\t\t\t: this.docfields;\n\n\t\tlet total_colsize = 0;\n\n\t\tthis.grid.visible_columns.forEach((col, ci) => {\n\t\t\t// to get update df for the row\n\t\t\tlet df = fields.find((field) => field?.fieldname === col[0].fieldname);\n\n\t\t\tthis.set_dependant_property(df);\n\n\t\t\tlet colsize = col[1];\n\n\t\t\ttotal_colsize += colsize;\n\t\t\tlet txt = this.doc\n\t\t\t\t? frappe.format(this.doc[df.fieldname], df, null, this.doc)\n\t\t\t\t: __(df.label, null, df.parent);\n\n\t\t\tif (this.doc && df.fieldtype === \"Select\") {\n\t\t\t\ttxt = __(txt);\n\t\t\t}\n\t\t\tlet column;\n\t\t\tif (!this.columns[df.fieldname] && !this.show_search) {\n\t\t\t\tcolumn = this.make_column(df, colsize, txt, ci);\n\t\t\t} else if (!this.columns[df.fieldname] && this.show_search) {\n\t\t\t\tcolumn = this.make_search_column(df, colsize);\n\t\t\t} else {\n\t\t\t\tcolumn = this.columns[df.fieldname];\n\t\t\t\tthis.refresh_field(df.fieldname, txt);\n\t\t\t}\n\n\t\t\t// background color for cell\n\t\t\tif (this.doc) {\n\t\t\t\tif (df.reqd && !txt) {\n\t\t\t\t\tcolumn.addClass(\"error\");\n\t\t\t\t}\n\t\t\t\tif (column.is_invalid) {\n\t\t\t\t\tcolumn.addClass(\"invalid\");\n\t\t\t\t} else if (df.reqd || df.bold) {\n\t\t\t\t\tcolumn.addClass(\"bold\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlet current_grid = $(\n\t\t\t`div[data-fieldname=\"${this.grid.df.fieldname}\"] .form-grid-container`\n\t\t);\n\t\tif (total_colsize > 10) {\n\t\t\tcurrent_grid.addClass(\"column-limit-reached\");\n\t\t} else if (current_grid.hasClass(\"column-limit-reached\")) {\n\t\t\tif (Number($(current_grid).children(\".form-grid\").css(\"left\")) != 0) {\n\t\t\t\t$(current_grid).children(\".form-grid\").css(\"left\", 0);\n\t\t\t\t$(current_grid).children().find(\".grid-scroll-bar\").css({\n\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t\"margin-left\": \"0px\",\n\t\t\t\t});\n\t\t\t\t$(current_grid).children().find(\".grid-scroll-bar-rows\").css(\"width\", \"auto\");\n\t\t\t}\n\t\t\tcurrent_grid.removeClass(\"column-limit-reached\");\n\t\t}\n\n\t\tif (this.show_search) {\n\t\t\t// last empty column\n\t\t\t$(`<div class=\"col grid-static-col search\"></div>`).appendTo(this.row);\n\t\t}\n\t}\n\n\tset_dependant_property(df) {\n\t\tif (\n\t\t\t!df.reqd &&\n\t\t\tdf.mandatory_depends_on &&\n\t\t\tthis.evaluate_depends_on_value(df.mandatory_depends_on)\n\t\t) {\n\t\t\tdf.reqd = 1;\n\t\t}\n\n\t\tif (\n\t\t\t!df.read_only &&\n\t\t\tdf.read_only_depends_on &&\n\t\t\tthis.evaluate_depends_on_value(df.read_only_depends_on)\n\t\t) {\n\t\t\tdf.read_only = 1;\n\t\t}\n\t}\n\n\tevaluate_depends_on_value(expression) {\n\t\tlet out = null;\n\t\tlet doc = this.doc;\n\n\t\tif (!doc) return;\n\n\t\tlet parent = this.frm ? this.frm.doc : this.doc || null;\n\n\t\tif (typeof expression === \"boolean\") {\n\t\t\tout = expression;\n\t\t} else if (typeof expression === \"function\") {\n\t\t\tout = expression(doc);\n\t\t} else if (expression.substr(0, 5) == \"eval:\") {\n\t\t\ttry {\n\t\t\t\tout = frappe.utils.eval(expression.substr(5), { doc, parent });\n\t\t\t\tif (parent && parent.istable && expression.includes(\"is_submittable\")) {\n\t\t\t\t\tout = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.throw(__('Invalid \"depends_on\" expression'));\n\t\t\t}\n\t\t} else if (expression.substr(0, 3) == \"fn:\" && this.frm) {\n\t\t\tout = this.frm.script_manager.trigger(\n\t\t\t\texpression.substr(3),\n\t\t\t\tthis.doctype,\n\t\t\t\tthis.docname\n\t\t\t);\n\t\t} else {\n\t\t\tvar value = doc[expression];\n\t\t\tif ($.isArray(value)) {\n\t\t\t\tout = !!value.length;\n\t\t\t} else {\n\t\t\t\tout = !!value;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tshow_search_row() {\n\t\t// show or remove search columns based on grid rows\n\t\tthis.show_search =\n\t\t\tthis.show_search && (this.grid?.data?.length >= 20 || this.grid.filter_applied);\n\t\t!this.show_search && this.wrapper.remove();\n\t\treturn this.show_search;\n\t}\n\n\tmake_search_column(df, colsize) {\n\t\tlet title = \"\";\n\t\tlet input_class = \"\";\n\t\tlet is_disabled = \"\";\n\n\t\tif ([\"Text\", \"Small Text\"].includes(df.fieldtype)) {\n\t\t\tinput_class = \"grid-overflow-no-ellipsis\";\n\t\t} else if ([\"Int\", \"Currency\", \"Float\", \"Percent\"].includes(df.fieldtype)) {\n\t\t\tinput_class = \"text-right\";\n\t\t} else if (df.fieldtype === \"Check\") {\n\t\t\ttitle = __(\"1 = True & 0 = False\");\n\t\t\tinput_class = \"text-center\";\n\t\t} else if (df.fieldtype === \"Password\") {\n\t\t\tis_disabled = \"disabled\";\n\t\t\ttitle = __(\"Password cannot be filtered\");\n\t\t}\n\n\t\tlet $col = $(\n\t\t\t'<div class=\"col grid-static-col col-xs-' + colsize + ' search\"></div>'\n\t\t).appendTo(this.row);\n\n\t\tlet $search_input = $(`\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"form-control input-xs ${input_class}\"\n\t\t\t\ttitle=\"${title}\"\n\t\t\t\tdata-fieldtype=\"${df.fieldtype}\"\n\t\t\t\t${is_disabled}\n\t\t\t>\n\t\t`).appendTo($col);\n\n\t\tthis.search_columns[df.fieldname] = $col;\n\n\t\t$search_input.on(\n\t\t\t\"keyup\",\n\t\t\tfrappe.utils.debounce((e) => {\n\t\t\t\tthis.grid.filter[df.fieldname] = {\n\t\t\t\t\tdf: df,\n\t\t\t\t\tvalue: e.target.value,\n\t\t\t\t};\n\n\t\t\t\tif (e.target.value == \"\") {\n\t\t\t\t\tdelete this.grid.filter[df.fieldname];\n\t\t\t\t}\n\n\t\t\t\tif (this.grid.grid_sortable) {\n\t\t\t\t\tthis.grid.grid_sortable.option(\n\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\tObject.keys(this.grid.filter).length !== 0\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.grid.prevent_build = true;\n\t\t\t\tthis.grid.grid_pagination.go_to_page(1);\n\t\t\t\tthis.grid.refresh();\n\t\t\t\tthis.grid.prevent_build = false;\n\t\t\t}, 500)\n\t\t);\n\n\t\t[\"Currency\", \"Float\", \"Int\", \"Percent\", \"Rating\"].includes(df.fieldtype) &&\n\t\t\tfrappe.utils.only_allow_num_decimal($search_input);\n\n\t\treturn $col;\n\t}\n\n\tmake_column(df, colsize, txt, ci) {\n\t\tlet me = this;\n\t\tvar add_class =\n\t\t\t[\"Text\", \"Small Text\"].indexOf(df.fieldtype) !== -1\n\t\t\t\t? \" grid-overflow-no-ellipsis\"\n\t\t\t\t: \"\";\n\t\tadd_class +=\n\t\t\t[\"Int\", \"Currency\", \"Float\", \"Percent\"].indexOf(df.fieldtype) !== -1\n\t\t\t\t? \" text-right\"\n\t\t\t\t: \"\";\n\t\tadd_class += [\"Check\"].indexOf(df.fieldtype) !== -1 ? \" text-center\" : \"\";\n\n\t\tlet grid;\n\t\tlet grid_container;\n\t\tlet input_in_focus = false;\n\n\t\t// prevent random layout shifts caused by widgets and on click position elements inside view (UX).\n\t\tfunction on_input_focus(el) {\n\t\t\tinput_in_focus = true;\n\n\t\t\tlet container_width = grid_container.getBoundingClientRect().width;\n\t\t\tlet container_left = grid_container.getBoundingClientRect().left;\n\t\t\tlet grid_left = parseFloat(grid.style.left);\n\t\t\tlet element_left = el.offset().left;\n\t\t\tlet fieldtype = el.data(\"fieldtype\");\n\n\t\t\tlet offset_right = container_width - (element_left + el.width());\n\t\t\tlet offset_left = 0;\n\t\t\tlet element_screen_x = element_left - container_left;\n\t\t\tlet element_position_x = container_width - (element_left - container_left);\n\n\t\t\tif ([\"Date\", \"Time\", \"Datetime\"].includes(fieldtype)) {\n\t\t\t\toffset_left = element_position_x - 220;\n\t\t\t}\n\t\t\tif ([\"Link\", \"Dynamic Link\"].includes(fieldtype)) {\n\t\t\t\toffset_left = element_position_x - 250;\n\t\t\t}\n\t\t\tif (element_screen_x < 0) {\n\t\t\t\tgrid.style.left = `${grid_left - element_screen_x}px`;\n\t\t\t} else if (offset_left < 0) {\n\t\t\t\tgrid.style.left = `${grid_left + offset_left}px`;\n\t\t\t} else if (offset_right < 0) {\n\t\t\t\tgrid.style.left = `${grid_left + offset_right}px`;\n\t\t\t}\n\t\t}\n\n\t\t// Delay date_picker widget to prevent temparary layout shift (UX).\n\t\tfunction handle_date_picker() {\n\t\t\tlet date_time_picker = document.querySelectorAll(\".datepicker.active\")[0];\n\n\t\t\tdate_time_picker.classList.remove(\"active\");\n\t\t\tdate_time_picker.style.width = \"220px\";\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tdate_time_picker.classList.add(\"active\");\n\t\t\t}, 600);\n\t\t}\n\n\t\tfunction trigger_focus(input_field, col_df) {\n\t\t\tif ([\"Date\", \"Datetime\"].includes(col_df.fieldtype) && col_df?.read_only) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tinput_field.trigger(\"focus\");\n\t\t}\n\n\t\tvar $col = $(\n\t\t\t'<div class=\"col grid-static-col col-xs-' + colsize + \" \" + add_class + '\"></div>'\n\t\t)\n\t\t\t.attr(\"data-fieldname\", df.fieldname)\n\t\t\t.attr(\"data-fieldtype\", df.fieldtype)\n\t\t\t.data(\"df\", df)\n\t\t\t.appendTo(this.row)\n\t\t\t.on(\"click\", function (event) {\n\t\t\t\tif (frappe.ui.form.editable_row !== me) {\n\t\t\t\t\tvar out = me.toggle_editable_row();\n\t\t\t\t}\n\t\t\t\tvar col = this;\n\t\t\t\tlet first_input_field = $(col).find('input[type=\"Text\"]:first');\n\t\t\t\tlet input_in_focus = false;\n\n\t\t\t\t$(col)\n\t\t\t\t\t.find(\"input[type='text']\")\n\t\t\t\t\t.each(function () {\n\t\t\t\t\t\tif ($(this).is(\":focus\")) {\n\t\t\t\t\t\t\tinput_in_focus = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t!input_in_focus && trigger_focus(first_input_field, $(col).data(\"df\"));\n\n\t\t\t\tif (event.pointerType == \"touch\") {\n\t\t\t\t\tfirst_input_field.length && on_input_focus(first_input_field);\n\n\t\t\t\t\tfirst_input_field.one(\"blur\", () => (input_in_focus = false));\n\n\t\t\t\t\tfirst_input_field.data(\"fieldtype\") == \"Date\" && handle_date_picker();\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t});\n\n\t\t$col.field_area = $('<div class=\"field-area\"></div>').appendTo($col).toggle(false);\n\t\t$col.static_area = $('<div class=\"static-area ellipsis\"></div>').appendTo($col).html(txt);\n\n\t\t// set title attribute to see full label for columns in the heading row\n\t\tif (!this.doc) {\n\t\t\t$col.attr(\"title\", txt);\n\t\t}\n\t\tdf.fieldname && $col.static_area.toggleClass(\"reqd\", Boolean(df.reqd));\n\n\t\t$col.df = df;\n\t\t$col.column_index = ci;\n\n\t\tthis.columns[df.fieldname] = $col;\n\t\tthis.columns_list.push($col);\n\n\t\treturn $col;\n\t}\n\n\tactivate() {\n\t\tthis.toggle_editable_row(true);\n\t\treturn this;\n\t}\n\n\ttoggle_editable_row(show) {\n\t\tvar me = this;\n\t\t// show static for field based on\n\t\t// whether grid is editable\n\t\tif (\n\t\t\tthis.grid.allow_on_grid_editing() &&\n\t\t\tthis.grid.is_editable() &&\n\t\t\tthis.doc &&\n\t\t\tshow !== false\n\t\t) {\n\t\t\t// disable other editable row\n\t\t\tif (frappe.ui.form.editable_row && frappe.ui.form.editable_row !== this) {\n\t\t\t\tfrappe.ui.form.editable_row.toggle_editable_row(false);\n\t\t\t}\n\n\t\t\tthis.row.toggleClass(\"editable-row\", true);\n\n\t\t\t// setup controls\n\t\t\tthis.columns_list.forEach(function (column) {\n\t\t\t\tme.make_control(column);\n\t\t\t\tcolumn.static_area.toggle(false);\n\t\t\t\tcolumn.field_area.toggle(true);\n\t\t\t});\n\n\t\t\tfrappe.ui.form.editable_row = this;\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.row.toggleClass(\"editable-row\", false);\n\n\t\t\tthis.columns_list.forEach((column, index) => {\n\t\t\t\tif (!this.frm) {\n\t\t\t\t\tlet df = this.grid.visible_columns[index][0];\n\n\t\t\t\t\tlet txt = this.doc\n\t\t\t\t\t\t? frappe.format(this.doc[df.fieldname], df, null, this.doc)\n\t\t\t\t\t\t: __(df.label, null, df.parent);\n\n\t\t\t\t\tthis.refresh_field(df.fieldname, txt);\n\t\t\t\t}\n\n\t\t\t\tif (!column.df.hidden) {\n\t\t\t\t\tcolumn.static_area.toggle(true);\n\t\t\t\t}\n\n\t\t\t\tcolumn.field_area && column.field_area.toggle(false);\n\t\t\t});\n\t\t\tfrappe.ui.form.editable_row = null;\n\t\t}\n\t}\n\n\tmake_control(column) {\n\t\tif (column.field) return;\n\n\t\tvar me = this,\n\t\t\tparent = column.field_area,\n\t\t\tdf = column.df;\n\n\t\tvar field = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: parent,\n\t\t\tonly_input: true,\n\t\t\twith_link_btn: true,\n\t\t\tdoc: this.doc,\n\t\t\tdoctype: this.doc.doctype,\n\t\t\tdocname: this.doc.name,\n\t\t\tfrm: this.grid.frm,\n\t\t\tgrid: this.grid,\n\t\t\tgrid_row: this,\n\t\t\tvalue: this.doc[df.fieldname],\n\t\t});\n\n\t\t// sync get_query\n\t\tfield.get_query = this.grid.get_field(df.fieldname).get_query;\n\n\t\tif (!field.df.onchange_modified) {\n\t\t\tvar field_on_change_function = field.df.onchange;\n\t\t\tfield.df.onchange = (e) => {\n\t\t\t\tfield_on_change_function && field_on_change_function.bind(field)(e);\n\t\t\t\tthis.refresh_field(field.df.fieldname);\n\t\t\t};\n\n\t\t\tfield.df.onchange_modified = true;\n\t\t}\n\n\t\tfield.refresh();\n\t\tif (field.$input) {\n\t\t\tfield.$input\n\t\t\t\t.addClass(\"input-sm\")\n\t\t\t\t.attr(\"data-col-idx\", column.column_index)\n\t\t\t\t.attr(\"placeholder\", __(df.placeholder || df.label));\n\t\t\t// flag list input\n\t\t\tif (this.columns_list && this.columns_list.slice(-1)[0] === column) {\n\t\t\t\tfield.$input.attr(\"data-last-input\", 1);\n\t\t\t}\n\t\t}\n\n\t\tthis.set_arrow_keys(field);\n\t\tcolumn.field = field;\n\t\tthis.on_grid_fields_dict[df.fieldname] = field;\n\t\tthis.on_grid_fields.push(field);\n\t}\n\n\tset_arrow_keys(field) {\n\t\tvar me = this;\n\t\tlet ignore_fieldtypes = [\"Text\", \"Small Text\", \"Code\", \"Text Editor\", \"HTML Editor\"];\n\t\tif (field.$input) {\n\t\t\tfield.$input.on(\"keydown\", function (e) {\n\t\t\t\tvar { ESCAPE, TAB, UP: UP_ARROW, DOWN: DOWN_ARROW } = frappe.ui.keyCode;\n\t\t\t\tif (![TAB, UP_ARROW, DOWN_ARROW, ESCAPE].includes(e.which)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar values = me.grid.get_data();\n\t\t\t\tvar fieldname = $(this).attr(\"data-fieldname\");\n\t\t\t\tvar fieldtype = $(this).attr(\"data-fieldtype\");\n\n\t\t\t\tlet ctrl_key = e.metaKey || e.ctrlKey;\n\t\t\t\tif (!ignore_fieldtypes.includes(fieldtype) && ctrl_key && e.which !== TAB) {\n\t\t\t\t\tme.add_new_row_using_keys(e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.shiftKey && e.altKey && DOWN_ARROW === e.which) {\n\t\t\t\t\tme.duplicate_row_using_keys();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar move_up_down = function (base) {\n\t\t\t\t\tif (ignore_fieldtypes.includes(fieldtype) && !e.altKey) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (field.autocomplete_open) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tbase.toggle_editable_row();\n\t\t\t\t\tvar input = base.columns[fieldname].field.$input;\n\t\t\t\t\tif (input) {\n\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\t// ESC\n\t\t\t\tif (e.which === ESCAPE && !e.shiftKey) {\n\t\t\t\t\tif (me.doc.__unedited) {\n\t\t\t\t\t\tme.grid.grid_rows[me.doc.idx - 1].remove();\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// TAB\n\t\t\t\tif (e.which === TAB && !e.shiftKey) {\n\t\t\t\t\tvar last_column = me.wrapper.find(\":input:enabled:last\").get(0);\n\t\t\t\t\tvar is_last_column = $(this).attr(\"data-last-input\") || last_column === this;\n\n\t\t\t\t\tif (is_last_column) {\n\t\t\t\t\t\t// last row\n\t\t\t\t\t\tif (me.doc.idx === values.length) {\n\t\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t\tme.grid.add_new_row(null, null, true);\n\t\t\t\t\t\t\t\tme.grid.grid_rows[\n\t\t\t\t\t\t\t\t\tme.grid.grid_rows.length - 1\n\t\t\t\t\t\t\t\t].toggle_editable_row();\n\t\t\t\t\t\t\t\tme.grid.set_focus_on_row();\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// last column before last row\n\t\t\t\t\t\t\tme.grid.grid_rows[me.doc.idx].toggle_editable_row();\n\t\t\t\t\t\t\tme.grid.set_focus_on_row(me.doc.idx);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (e.which === UP_ARROW) {\n\t\t\t\t\tif (me.doc.idx > 1) {\n\t\t\t\t\t\tvar prev = me.grid.grid_rows[me.doc.idx - 2];\n\t\t\t\t\t\tif (move_up_down(prev)) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (e.which === DOWN_ARROW) {\n\t\t\t\t\tif (me.doc.idx < values.length) {\n\t\t\t\t\t\tvar next = me.grid.grid_rows[me.doc.idx];\n\t\t\t\t\t\tif (move_up_down(next)) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tduplicate_row_using_keys() {\n\t\tsetTimeout(() => {\n\t\t\tthis.insert(false, true, true);\n\t\t\tthis.grid.grid_rows[this.doc.idx].toggle_editable_row();\n\t\t\tthis.grid.set_focus_on_row(this.doc.idx);\n\t\t}, 100);\n\t}\n\n\tadd_new_row_using_keys(e) {\n\t\tlet idx = \"\";\n\n\t\tlet ctrl_key = e.metaKey || e.ctrlKey;\n\t\tlet is_down_arrow_key_press = e.which === 40;\n\n\t\t// Add new row at the end or start of the table\n\t\tif (ctrl_key && e.shiftKey) {\n\t\t\tidx = is_down_arrow_key_press ? null : 1;\n\t\t\tthis.grid.add_new_row(\n\t\t\t\tidx,\n\t\t\t\tnull,\n\t\t\t\tis_down_arrow_key_press,\n\t\t\t\tfalse,\n\t\t\t\tis_down_arrow_key_press,\n\t\t\t\t!is_down_arrow_key_press\n\t\t\t);\n\t\t\tidx = is_down_arrow_key_press ? cint(this.grid.grid_rows.length) - 1 : 0;\n\t\t} else if (ctrl_key) {\n\t\t\tidx = is_down_arrow_key_press ? this.doc.idx : this.doc.idx - 1;\n\t\t\tthis.insert(false, is_down_arrow_key_press);\n\t\t}\n\n\t\tif (idx !== \"\") {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.grid.grid_rows[idx].toggle_editable_row();\n\t\t\t\tthis.grid.set_focus_on_row(idx);\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tget_open_form() {\n\t\treturn frappe.ui.form.get_open_grid_form();\n\t}\n\n\ttoggle_view(show, callback) {\n\t\tif (!this.doc) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (this.frm) {\n\t\t\t// reload doc\n\t\t\tthis.doc = locals[this.doc.doctype][this.doc.name];\n\t\t}\n\n\t\t// hide other\n\t\tvar open_row = this.get_open_form();\n\n\t\tif (show === undefined) show = !open_row;\n\n\t\t// call blur\n\t\tdocument.activeElement && document.activeElement.blur();\n\n\t\tif (show && open_row) {\n\t\t\tif (open_row == this) {\n\t\t\t\t// already open, do nothing\n\t\t\t\tcallback && callback();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// close other views\n\t\t\t\topen_row.toggle_view(false);\n\t\t\t}\n\t\t}\n\n\t\tif (show) {\n\t\t\tthis.show_form();\n\t\t} else {\n\t\t\tthis.hide_form();\n\t\t}\n\t\tcallback && callback();\n\n\t\treturn this;\n\t}\n\tshow_form() {\n\t\tif (frappe.utils.is_xs()) {\n\t\t\t$(this.grid.form_grid).css(\"min-width\", \"0\");\n\t\t\t$(this.grid.form_grid).css(\"position\", \"unset\");\n\t\t}\n\t\tif (!this.grid_form) {\n\t\t\tthis.grid_form = new GridRowForm({\n\t\t\t\trow: this,\n\t\t\t});\n\t\t}\n\t\tthis.grid_form.render();\n\t\tthis.row.toggle(false);\n\t\t// this.form_panel.toggle(true);\n\n\t\tlet cannot_add_rows =\n\t\t\tthis.grid.cannot_add_rows || (this.grid.df && this.grid.df.cannot_add_rows);\n\t\tthis.wrapper\n\t\t\t.find(\n\t\t\t\t\".grid-insert-row-below, .grid-insert-row, .grid-duplicate-row, .grid-append-row\"\n\t\t\t)\n\t\t\t.toggle(!cannot_add_rows);\n\n\t\tthis.wrapper\n\t\t\t.find(\".grid-delete-row\")\n\t\t\t.toggle(!(this.grid.df && this.grid.df.cannot_delete_rows));\n\n\t\tfrappe.dom.freeze(\"\", \"dark grid-form\");\n\t\tif (cur_frm) cur_frm.cur_grid = this;\n\t\tthis.wrapper.addClass(\"grid-row-open\");\n\t\tif (\n\t\t\t!frappe.dom.is_element_in_viewport(this.wrapper) &&\n\t\t\t!frappe.dom.is_element_in_modal(this.wrapper)\n\t\t) {\n\t\t\t// -15 offset to make form look visually centered\n\t\t\tfrappe.utils.scroll_to(this.wrapper, true, -15);\n\t\t}\n\n\t\tif (this.frm) {\n\t\t\tthis.frm.script_manager.trigger(this.doc.parentfield + \"_on_form_rendered\");\n\t\t\tthis.frm.script_manager.trigger(\"form_render\", this.doc.doctype, this.doc.name);\n\t\t}\n\t}\n\thide_form() {\n\t\tif (frappe.utils.is_xs()) {\n\t\t\t$(this.grid.form_grid).css(\"min-width\", \"738px\");\n\t\t\t$(this.grid.form_grid).css(\"position\", \"relative\");\n\t\t}\n\t\tfrappe.dom.unfreeze();\n\t\tthis.row.toggle(true);\n\t\tif (!frappe.dom.is_element_in_modal(this.row)) {\n\t\t\tfrappe.utils.scroll_to(this.row, true, 15);\n\t\t}\n\t\tthis.refresh();\n\t\tif (cur_frm) cur_frm.cur_grid = null;\n\t\tthis.wrapper.removeClass(\"grid-row-open\");\n\t}\n\thas_prev() {\n\t\treturn this.doc.idx > 1;\n\t}\n\topen_prev() {\n\t\tif (!this.doc) return;\n\t\tthis.open_row_at_index(this.doc.idx - 2);\n\t}\n\thas_next() {\n\t\treturn this.doc.idx < this.grid.data.length;\n\t}\n\topen_next() {\n\t\tif (!this.doc) return;\n\n\t\tthis.open_row_at_index(this.doc.idx);\n\t}\n\topen_row_at_index(row_index) {\n\t\tif (!this.grid.data[row_index]) return;\n\n\t\tthis.change_page_if_reqd(row_index);\n\t\tthis.grid.grid_rows[row_index].toggle_view(true);\n\t\treturn true;\n\t}\n\tchange_page_if_reqd(row_index) {\n\t\tconst { page_index, page_length } = this.grid.grid_pagination;\n\n\t\trow_index++;\n\t\tlet new_page;\n\n\t\tif (row_index <= (page_index - 1) * page_length) {\n\t\t\tnew_page = page_index - 1;\n\t\t} else if (row_index > page_index * page_length) {\n\t\t\tnew_page = page_index + 1;\n\t\t}\n\n\t\tif (new_page) {\n\t\t\tthis.grid.grid_pagination.go_to_page(new_page);\n\t\t}\n\t}\n\trefresh_field(fieldname, txt) {\n\t\tlet fields =\n\t\t\tthis.grid.user_defined_columns && this.grid.user_defined_columns.length > 0\n\t\t\t\t? this.grid.user_defined_columns\n\t\t\t\t: this.docfields;\n\n\t\tlet df = fields.find((col) => {\n\t\t\treturn col?.fieldname === fieldname;\n\t\t});\n\n\t\t// format values if no frm\n\t\tif (df && this.doc) {\n\t\t\ttxt = frappe.format(this.doc[fieldname], df, null, this.doc);\n\t\t}\n\n\t\tif (!txt && this.frm) {\n\t\t\ttxt = frappe.format(this.doc[fieldname], df, null, this.frm.doc);\n\t\t}\n\n\t\t// reset static value\n\t\tlet column = this.columns[fieldname];\n\t\tif (column) {\n\t\t\tcolumn.static_area.html(txt || \"\");\n\t\t\tif (df && df.reqd) {\n\t\t\t\tcolumn.toggleClass(\"error\", !!(txt === null || txt === \"\"));\n\t\t\t}\n\t\t}\n\n\t\tlet field = this.on_grid_fields_dict[fieldname];\n\t\t// reset field value\n\t\tif (field) {\n\t\t\t// the below if statement is added to factor in the exception when this.doc is undefined -\n\t\t\t// - after row removals via customize_form.js on links, actions and states child-tables\n\t\t\tif (this.doc) field.docname = this.doc.name;\n\t\t\tfield.refresh();\n\t\t}\n\n\t\t// in form\n\t\tif (this.grid_form) {\n\t\t\tthis.grid_form.refresh_field(fieldname);\n\t\t}\n\t}\n\tget_field(fieldname) {\n\t\tlet field = this.on_grid_fields_dict[fieldname];\n\t\tif (field) {\n\t\t\treturn field;\n\t\t} else if (this.grid_form) {\n\t\t\treturn this.grid_form.fields_dict[fieldname];\n\t\t} else {\n\t\t\tthrow `fieldname ${fieldname} not found`;\n\t\t}\n\t}\n\n\tget_visible_columns(blacklist = []) {\n\t\tvar me = this;\n\t\tvar visible_columns = $.map(this.docfields, function (df) {\n\t\t\tvar visible =\n\t\t\t\t!df.hidden &&\n\t\t\t\tdf.in_list_view &&\n\t\t\t\tme.grid.frm.get_perm(df.permlevel, \"read\") &&\n\t\t\t\t!frappe.model.layout_fields.includes(df.fieldtype) &&\n\t\t\t\t!blacklist.includes(df.fieldname);\n\n\t\t\treturn visible ? df : null;\n\t\t});\n\t\treturn visible_columns;\n\t}\n\tset_field_property(fieldname, property, value) {\n\t\t// set a field property for open form / grid form\n\t\tvar me = this;\n\n\t\tvar set_property = function (field) {\n\t\t\tif (!field) return;\n\t\t\tfield.df[property] = value;\n\t\t\tfield.refresh();\n\t\t};\n\n\t\t// set property in grid form\n\t\tif (this.grid_form) {\n\t\t\tset_property(this.grid_form.fields_dict[fieldname]);\n\t\t\tthis.grid_form.layout && this.grid_form.layout.refresh_sections();\n\t\t}\n\n\t\t// set property in on grid fields\n\t\tset_property(this.on_grid_fields_dict[fieldname]);\n\t}\n\ttoggle_reqd(fieldname, reqd) {\n\t\tthis.set_field_property(fieldname, \"reqd\", reqd ? 1 : 0);\n\t}\n\ttoggle_display(fieldname, show) {\n\t\tthis.set_field_property(fieldname, \"hidden\", show ? 0 : 1);\n\t}\n\ttoggle_editable(fieldname, editable) {\n\t\tthis.set_field_property(fieldname, \"read_only\", editable ? 0 : 1);\n\t}\n}", "export default class GridPagination {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.setup_pagination();\n\t}\n\n\tsetup_pagination() {\n\t\tthis.page_length = 50;\n\t\tthis.page_index = 1;\n\t\tthis.total_pages = Math.ceil(this.grid.data.length / this.page_length);\n\n\t\tthis.render_pagination();\n\t}\n\n\trender_pagination() {\n\t\tif (this.grid.data.length <= this.page_length) {\n\t\t\tthis.wrapper.find(\".grid-pagination\").html(\"\");\n\t\t} else {\n\t\t\tlet $pagination_template = this.get_pagination_html();\n\t\t\tthis.wrapper.find(\".grid-pagination\").html($pagination_template);\n\t\t\tthis.prev_page_button = this.wrapper.find(\".prev-page\");\n\t\t\tthis.next_page_button = this.wrapper.find(\".next-page\");\n\t\t\tthis.$page_number = this.wrapper.find(\".current-page-number\");\n\t\t\tthis.$total_pages = this.wrapper.find(\".total-page-number\");\n\t\t\tthis.first_page_button = this.wrapper.find(\".first-page\");\n\t\t\tthis.last_page_button = this.wrapper.find(\".last-page\");\n\n\t\t\tthis.bind_pagination_events();\n\t\t}\n\t}\n\n\tbind_pagination_events() {\n\t\tthis.prev_page_button.on(\"click\", () => {\n\t\t\tthis.render_prev_page();\n\t\t});\n\n\t\tthis.next_page_button.on(\"click\", () => {\n\t\t\tthis.render_next_page();\n\t\t});\n\n\t\tthis.first_page_button.on(\"click\", () => {\n\t\t\tthis.go_to_page(1);\n\t\t});\n\n\t\tthis.last_page_button.on(\"click\", () => {\n\t\t\tthis.go_to_page(this.total_pages);\n\t\t});\n\n\t\tthis.$page_number.on(\"keyup\", (e) => {\n\t\t\te.currentTarget.style.width = (e.currentTarget.value.length + 1) * 8 + \"px\";\n\t\t});\n\n\t\tthis.$page_number.on(\"keydown\", (e) => {\n\t\t\te = e ? e : window.event;\n\t\t\tvar charCode = e.which ? e.which : e.keyCode;\n\t\t\tlet arrow = { up: 38, down: 40 };\n\n\t\t\tswitch (charCode) {\n\t\t\t\tcase arrow.up:\n\t\t\t\t\tthis.inc_dec_number(true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase arrow.down:\n\t\t\t\t\tthis.inc_dec_number(false);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// only allow numbers from 0-9 and up, down, left, right arrow keys\n\t\t\tif (\n\t\t\t\tcharCode > 31 &&\n\t\t\t\t(charCode < 48 || charCode > 57) &&\n\t\t\t\t![37, 38, 39, 40].includes(charCode)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tthis.$page_number.on(\"focusout\", (e) => {\n\t\t\tif (this.page_index == e.currentTarget.value) return;\n\t\t\tthis.page_index = e.currentTarget.value;\n\n\t\t\tif (this.page_index < 1) {\n\t\t\t\tthis.page_index = 1;\n\t\t\t} else if (this.page_index > this.total_pages) {\n\t\t\t\tthis.page_index = this.total_pages;\n\t\t\t}\n\n\t\t\tthis.go_to_page();\n\t\t});\n\t}\n\n\tinc_dec_number(increment) {\n\t\tlet new_value = parseInt(this.$page_number.val());\n\t\tincrement ? new_value++ : new_value--;\n\n\t\tif (new_value < 1 || new_value > this.total_pages) return;\n\n\t\tthis.$page_number.val(new_value);\n\t}\n\n\tupdate_page_numbers() {\n\t\tlet total_pages = Math.ceil(this.grid.data.length / this.page_length);\n\t\tif (this.total_pages !== total_pages) {\n\t\t\tthis.total_pages = total_pages;\n\t\t\tthis.render_pagination();\n\t\t}\n\t}\n\n\tcheck_page_number() {\n\t\tif (this.page_index > this.total_pages && this.page_index > 1) {\n\t\t\tthis.go_to_page(this.page_index - 1);\n\t\t}\n\t}\n\n\tget_pagination_html() {\n\t\tlet page_text_html = `<div class=\"page-text\">\n\t\t\t\t<input class=\"current-page-number page-number\" type=\"text\" value=\"${__(this.page_index)}\"/>\n\t\t\t\t<span>${__(\"of\")}</span>\n\t\t\t\t<span class=\"total-page-number page-number\"> ${__(this.total_pages)} </span>\n\t\t\t</div>`;\n\n\t\treturn $(`<button class=\"btn btn-secondary btn-xs first-page\"\">\n\t\t\t\t<span>${__(\"First\")}</span>\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-secondary btn-xs prev-page\">${frappe.utils.icon(\"left\", \"xs\")}</button>\n\t\t\t${page_text_html}\n\t\t\t<button class=\"btn btn-secondary btn-xs next-page\">${frappe.utils.icon(\"right\", \"xs\")}</button>\n\t\t\t<button class=\"btn btn-secondary btn-xs last-page\">\n\t\t\t\t<span>${__(\"Last\")}</span>\n\t\t\t</button>`);\n\t}\n\n\trender_next_page() {\n\t\tif (this.page_index * this.page_length < this.grid.data.length) {\n\t\t\tthis.page_index++;\n\t\t\tthis.go_to_page();\n\t\t}\n\t}\n\n\trender_prev_page() {\n\t\tif (this.page_index > 1) {\n\t\t\tthis.page_index--;\n\t\t\tthis.go_to_page();\n\t\t}\n\t}\n\n\tgo_to_page(index, from_refresh) {\n\t\tif (!index) {\n\t\t\tindex = this.page_index;\n\t\t} else {\n\t\t\tthis.page_index = index;\n\t\t}\n\t\tlet $rows = $(this.grid.parent).find(\".rows\").empty();\n\t\tthis.grid.render_result_rows($rows, true);\n\t\tif (this.$page_number) {\n\t\t\tthis.$page_number.val(index);\n\t\t\tthis.$page_number.css(\"width\", (index.toString().length + 1) * 8 + \"px\");\n\t\t}\n\n\t\tthis.update_page_numbers();\n\t\tif (!from_refresh) {\n\t\t\tthis.grid.scroll_to_top();\n\t\t}\n\t}\n\n\tgo_to_last_page_to_add_row() {\n\t\tlet total_pages = this.total_pages;\n\t\tlet page_length = this.page_length;\n\t\tif (this.grid.data.length == page_length * total_pages) {\n\t\t\tthis.go_to_page(total_pages + 1);\n\t\t\tfrappe.utils.scroll_to(this.wrapper);\n\t\t} else if (this.page_index == this.total_pages) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.go_to_page(total_pages);\n\t\t}\n\t}\n\n\tget_result_length() {\n\t\treturn this.grid.data.length < this.page_index * this.page_length\n\t\t\t? this.grid.data.length\n\t\t\t: this.page_index * this.page_length;\n\t}\n}", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nimport GridRow from \"./grid_row\";\nimport GridPagination from \"./grid_pagination\";\n\nfrappe.ui.form.get_open_grid_form = function () {\n\treturn $(\".grid-row-open\").data(\"grid_row\");\n};\n\nfrappe.ui.form.close_grid_form = function () {\n\tvar open_form = frappe.ui.form.get_open_grid_form();\n\topen_form && open_form.hide_form();\n\n\t// hide editable row too\n\tif (frappe.ui.form.editable_row) {\n\t\tfrappe.ui.form.editable_row.toggle_editable_row(false);\n\t}\n};\n\nexport default class Grid {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.fieldinfo = {};\n\t\tthis.doctype = this.df.options;\n\n\t\tif (this.doctype) {\n\t\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\t}\n\t\tthis.fields_map = {};\n\t\tthis.template = null;\n\t\tthis.multiple_set = false;\n\t\tif (\n\t\t\tthis.frm &&\n\t\t\tthis.frm.meta.__form_grid_templates &&\n\t\t\tthis.frm.meta.__form_grid_templates[this.df.fieldname]\n\t\t) {\n\t\t\tthis.template = this.frm.meta.__form_grid_templates[this.df.fieldname];\n\t\t}\n\t\tthis.filter = {};\n\t\tthis.is_grid = true;\n\t\tthis.debounced_refresh = this.refresh.bind(this);\n\t\tthis.debounced_refresh = frappe.utils.debounce(this.debounced_refresh, 100);\n\t\tthis.setup_tab_listeners();\n\t}\n\n\tsetup_tab_listeners() {\n\t\t$(\".nav-link\").on(\"shown.bs.tab\", () => {\n\t\t\tthis.handle_scroll_bar();\n\t\t});\n\t}\n\thandle_scroll_bar() {\n\t\tfrappe.utils.sleep(500).then(() => {\n\t\t\tlet grid_body_width = this.wrapper.find(\".grid-body\").width();\n\n\t\t\tlet grid_scroll_bar = this.wrapper.find(\".grid-scroll-bar\");\n\n\t\t\tlet grid_scroll_bar_rows = this.wrapper.find(\".grid-scroll-bar-rows\");\n\n\t\t\tgrid_scroll_bar.width(this.form_grid.width());\n\t\t\tgrid_scroll_bar_rows.width(grid_body_width);\n\n\t\t\tgrid_scroll_bar.on(\"scroll\", (event) => {\n\t\t\t\t// Sync the form grid's left position with the scroll bar\n\t\t\t\tthis.form_grid.css(\"position\", \"relative\");\n\t\t\t\tthis.form_grid.css(\"left\", -$(event.currentTarget).scrollLeft() + \"px\");\n\t\t\t});\n\t\t});\n\t}\n\n\tget perm() {\n\t\treturn this.control?.perm || this.frm?.perm || this.df.perm;\n\t}\n\n\tset perm(_perm) {\n\t\tconsole.error(\"Setting perm on grid isn't supported, update form's perm instead\");\n\t}\n\n\tallow_on_grid_editing() {\n\t\tif ((this.meta && this.meta.editable_grid) || !this.meta) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tmake() {\n\t\tlet template = `\n\t\t\t<div class=\"grid-field\">\n\t\t\t\t<label class=\"control-label\">${__(this.df.label || \"\")}</label>\n\t\t\t\t<span class=\"help\"></span>\n\t\t\t\t<p class=\"text-muted small grid-description\"></p>\n\t\t\t\t<div class=\"grid-custom-buttons\"></div>\n\t\t\t\t<div class=\"form-grid-container\">\n\t\t\t\t\t<div class=\"form-grid\">\n\t\t\t\t\t\t<div class=\"grid-heading-row\"></div>\n\t\t\t\t\t\t<div class=\"grid-body\">\n\t\t\t\t\t\t\t<div class=\"rows\"></div>\n\t\t\t\t\t\t\t<div class=\"grid-empty text-center text-extra-muted\">\n\t\t\t\t\t\t\t\t${__(\"No rows\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"grid-scroll-bar\">\n\t\t\t\t\t\t<div class=\"grid-scroll-bar-rows\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"small form-clickable-section grid-footer\">\n\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t<div class=\"grid-buttons\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-danger grid-remove-rows hidden\"\n\t\t\t\t\t\t\t\tdata-action=\"delete_rows\">\n\t\t\t\t\t\t\t\t${__(\"Delete\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-danger grid-remove-all-rows hidden\"\n\t\t\t\t\t\t\t\tdata-action=\"delete_all_rows\">\n\t\t\t\t\t\t\t\t${__(\"Delete All\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<!-- hack to allow firefox include this in tabs -->\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-secondary grid-add-row\">\n\t\t\t\t\t\t\t\t${__(\"Add Row\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"grid-add-multiple-rows btn btn-xs btn-secondary hidden\">\n\t\t\t\t\t\t\t\t${__(\"Add Multiple\")}</a>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"grid-pagination\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"grid-bulk-actions text-right\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"grid-download btn btn-xs btn-secondary hidden\">\n\t\t\t\t\t\t\t\t${__(\"Download\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"grid-upload btn btn-xs btn-secondary hidden\">\n\t\t\t\t\t\t\t\t${__(\"Upload\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.wrapper = $(template).appendTo(this.parent);\n\t\t$(this.parent).addClass(\"form-group\");\n\t\tthis.set_grid_description();\n\t\tthis.set_doc_url();\n\n\t\tfrappe.utils.bind_actions_with_object(this.wrapper, this);\n\n\t\tthis.form_grid = this.wrapper.find(\".form-grid\");\n\n\t\tif (this.form_grid) {\n\t\t\tthis.form_grid.on(\"wheel\", (e) => {\n\t\t\t\tconst isTrackpad = Math.abs(e.originalEvent.wheelDeltaY) < 50;\n\t\t\t\tconst delta = e.originalEvent.deltaX;\n\t\t\t\tconst scroll_bar = this.wrapper.find(\".grid-scroll-bar\");\n\n\t\t\t\tif (isTrackpad) {\n\t\t\t\t\tscroll_bar.scrollLeft(scroll_bar.scrollLeft() + delta);\n\t\t\t\t} else {\n\t\t\t\t\tscroll_bar.scrollLeft(scroll_bar.scrollLeft() + delta * 4);\n\t\t\t\t}\n\n\t\t\t\t// prevent default behaviour when it is scrolled horizontally\n\t\t\t\tif (e.originalEvent.deltaX != 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet touchStartX = 0;\n\t\t\tlet touchMoveX = 0;\n\t\t\tlet isTouchScrolling = false;\n\n\t\t\t// Handle touch start\n\t\t\tthis.form_grid.on(\"touchstart\", (e) => {\n\t\t\t\tconst touch = e.originalEvent.touches[0];\n\t\t\t\ttouchStartX = touch.pageX;\n\t\t\t\tisTouchScrolling = true;\n\t\t\t});\n\n\t\t\t// Handle touch move\n\t\t\tthis.form_grid.on(\"touchmove\", (e) => {\n\t\t\t\tif (!isTouchScrolling) return;\n\n\t\t\t\tconst touch = e.originalEvent.touches[0];\n\t\t\t\ttouchMoveX = touch.pageX;\n\n\t\t\t\tconst scrollBar = this.wrapper.find(\".grid-scroll-bar\");\n\t\t\t\tconst deltaX = touchStartX - touchMoveX;\n\n\t\t\t\tscrollBar.scrollLeft(scrollBar.scrollLeft() + deltaX);\n\n\t\t\t\ttouchStartX = touchMoveX;\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\t// Handle touch end\n\t\t\tthis.form_grid.on(\"touchend\", () => {\n\t\t\t\tisTouchScrolling = false;\n\t\t\t});\n\n\t\t\tthis.handle_scroll_bar();\n\t\t}\n\t\tthis.setup_add_row();\n\n\t\tthis.setup_grid_pagination();\n\n\t\tthis.custom_buttons = {};\n\t\tthis.grid_buttons = this.wrapper.find(\".grid-buttons\");\n\t\tthis.grid_custom_buttons = this.wrapper.find(\".grid-custom-buttons\");\n\t\tthis.remove_rows_button = this.grid_buttons.find(\".grid-remove-rows\");\n\t\tthis.remove_all_rows_button = this.grid_buttons.find(\".grid-remove-all-rows\");\n\n\t\tthis.setup_allow_bulk_edit();\n\t\tthis.setup_check();\n\t\tif (this.df.on_setup) {\n\t\t\tthis.df.on_setup(this);\n\t\t}\n\t}\n\tset_grid_description() {\n\t\tlet description_wrapper = $(this.parent).find(\".grid-description\");\n\t\tif (this.df.description) {\n\t\t\tdescription_wrapper.html(__(this.df.description));\n\t\t} else {\n\t\t\tdescription_wrapper.hide();\n\t\t}\n\t}\n\n\tset_doc_url() {\n\t\tlet unsupported_fieldtypes = frappe.model.no_value_type.filter(\n\t\t\t(x) => frappe.model.table_fields.indexOf(x) === -1\n\t\t);\n\n\t\tif (\n\t\t\t!this.df.label ||\n\t\t\t!this.df?.documentation_url ||\n\t\t\tunsupported_fieldtypes.includes(this.df.fieldtype)\n\t\t)\n\t\t\treturn;\n\n\t\tlet $help = $(this.parent).find(\"span.help\");\n\t\t$help.empty();\n\t\t$(`<a href=\"${this.df.documentation_url}\" target=\"_blank\">\n\t\t\t${frappe.utils.icon(\"help\", \"sm\")}\n\t\t</a>`).appendTo($help);\n\t}\n\n\tsetup_grid_pagination() {\n\t\tthis.grid_pagination = new GridPagination({\n\t\t\tgrid: this,\n\t\t\twrapper: this.wrapper,\n\t\t});\n\t}\n\n\tsetup_check() {\n\t\tthis.wrapper.on(\"click\", \".grid-row-check\", (e) => {\n\t\t\tconst $check = $(e.currentTarget);\n\t\t\tconst checked = $check.prop(\"checked\");\n\t\t\tconst is_select_all = $check.parents(\".grid-heading-row:first\").length !== 0;\n\t\t\tconst docname = $check.parents(\".grid-row:first\")?.attr(\"data-name\");\n\n\t\t\tif (is_select_all) {\n\t\t\t\t// (un)check all visible checkboxes\n\t\t\t\tthis.form_grid.find(\".grid-row-check\").prop(\"checked\", checked);\n\n\t\t\t\t// set following rows as checked in model\n\t\t\t\tlet result_length = this.grid_pagination.get_result_length();\n\t\t\t\tlet page_index = this.grid_pagination.page_index;\n\t\t\t\tlet page_length = this.grid_pagination.page_length;\n\t\t\t\tfor (let ri = (page_index - 1) * page_length; ri < result_length; ri++) {\n\t\t\t\t\tthis.grid_rows[ri].select(checked);\n\t\t\t\t}\n\t\t\t} else if (docname) {\n\t\t\t\tif (e.shiftKey && this.last_checked_docname) {\n\t\t\t\t\tthis.check_range(docname, this.last_checked_docname, checked);\n\t\t\t\t}\n\t\t\t\tthis.grid_rows_by_docname[docname].select(checked);\n\t\t\t\tthis.last_checked_docname = docname;\n\t\t\t}\n\t\t\tthis.refresh_remove_rows_button();\n\t\t});\n\t}\n\n\t/**\n\t * Checks or unchecks all checkboxes between two rows (included), given their docnames.\n\t * Rows are only checked only if both parameters are valid docnames.\n\t * @param {string} docname1\n\t * @param {string} docname2\n\t */\n\tcheck_range(docname1, docname2, checked = true) {\n\t\tconst row_1 = this.grid_rows_by_docname[docname1];\n\t\tconst row_2 = this.grid_rows_by_docname[docname2];\n\t\tconst index_1 = this.grid_rows.indexOf(row_1);\n\t\tconst index_2 = this.grid_rows.indexOf(row_2);\n\t\tif (index_1 === -1 || index_2 === -1) return;\n\t\tconst [start, end] = [index_1, index_2].sort((a, b) => a - b);\n\t\tconst rows = this.grid_rows.slice(start, end + 1);\n\t\tfor (const row of rows) {\n\t\t\trow.select(checked);\n\t\t\trow.row_check?.find(\".grid-row-check\").prop(\"checked\", checked);\n\t\t}\n\t}\n\n\tdelete_rows() {\n\t\tvar dirty = false;\n\n\t\tlet tasks = [];\n\t\tlet selected_children = this.get_selected_children();\n\t\tselected_children.forEach((doc) => {\n\t\t\ttasks.push(() => {\n\t\t\t\tif (!this.frm) {\n\t\t\t\t\tthis.df.data = this.get_data();\n\t\t\t\t\tthis.df.data = this.df.data.filter((row) => row.idx != doc.idx);\n\t\t\t\t}\n\t\t\t\tthis.grid_rows_by_docname[doc.name]?.remove();\n\t\t\t\tdirty = true;\n\t\t\t});\n\t\t\ttasks.push(() => frappe.timeout(0.1));\n\t\t});\n\n\t\tif (!this.frm) {\n\t\t\ttasks.push(() => {\n\t\t\t\t// reorder idx of df.data\n\t\t\t\tthis.df.data.forEach((row, index) => (row.idx = index + 1));\n\t\t\t});\n\t\t}\n\n\t\ttasks.push(() => {\n\t\t\tif (dirty) {\n\t\t\t\tthis.refresh();\n\t\t\t\tthis.frm &&\n\t\t\t\t\tthis.frm.script_manager.trigger(this.df.fieldname + \"_delete\", this.doctype);\n\t\t\t}\n\t\t});\n\n\t\tfrappe.run_serially(tasks);\n\n\t\tthis.wrapper.find(\".grid-heading-row .grid-row-check:checked:first\").prop(\"checked\", 0);\n\t\tif (selected_children.length == this.grid_pagination.page_length) {\n\t\t\tthis.scroll_to_top();\n\t\t}\n\t}\n\n\tdelete_all_rows() {\n\t\tfrappe.confirm(__(\"Are you sure you want to delete all rows?\"), () => {\n\t\t\tthis.frm.doc[this.df.fieldname] = [];\n\t\t\t$(this.parent).find(\".rows\").empty();\n\t\t\tthis.grid_rows = [];\n\t\t\tthis.refresh();\n\t\t\tthis.frm &&\n\t\t\t\tthis.frm.script_manager.trigger(this.df.fieldname + \"_delete\", this.doctype);\n\t\t\tthis.frm && this.frm.dirty();\n\t\t\tthis.scroll_to_top();\n\t\t});\n\t}\n\n\tscroll_to_top() {\n\t\tfrappe.utils.scroll_to(this.wrapper);\n\t}\n\n\tselect_row(name) {\n\t\tthis.grid_rows_by_docname[name].select();\n\t}\n\n\tremove_all() {\n\t\tthis.grid_rows.forEach((row) => {\n\t\t\trow.remove();\n\t\t});\n\t}\n\n\trefresh_remove_rows_button() {\n\t\tif (this.df.cannot_delete_rows) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.remove_rows_button.toggleClass(\n\t\t\t\"hidden\",\n\t\t\tthis.wrapper.find(\".grid-body .grid-row-check:checked:first\").length ? false : true\n\t\t);\n\n\t\tlet select_all_checkbox_checked = this.wrapper.find(\n\t\t\t\".grid-heading-row .grid-row-check:checked:first\"\n\t\t).length;\n\t\tlet show_delete_all_btn =\n\t\t\tselect_all_checkbox_checked && this.data.length > this.get_selected_children().length;\n\t\tthis.remove_all_rows_button.toggleClass(\"hidden\", !show_delete_all_btn);\n\t}\n\n\tdebounced_refresh_remove_rows_button = frappe.utils.debounce(\n\t\tthis.refresh_remove_rows_button,\n\t\t100\n\t);\n\n\tget_selected() {\n\t\treturn (this.grid_rows || [])\n\t\t\t.map((row) => {\n\t\t\t\treturn row.doc.__checked ? row.doc.name : null;\n\t\t\t})\n\t\t\t.filter((d) => {\n\t\t\t\treturn d;\n\t\t\t});\n\t}\n\n\tget_selected_children() {\n\t\treturn (this.data || [])\n\t\t\t.map((row) => {\n\t\t\t\treturn row.__checked ? row : 0;\n\t\t\t})\n\t\t\t.filter((d) => {\n\t\t\t\treturn d;\n\t\t\t});\n\t}\n\n\treset_grid() {\n\t\tthis.visible_columns = [];\n\t\tthis.grid_rows = [];\n\n\t\t$(this.parent).find(\".grid-body .grid-row\").remove();\n\t\tthis.refresh();\n\t}\n\n\tmake_head() {\n\t\tif (this.prevent_build) return;\n\n\t\t// labels\n\t\tif (this.header_row) {\n\t\t\t$(this.parent).find(\".grid-heading-row .grid-row\").remove();\n\t\t}\n\t\tthis.header_row = new GridRow({\n\t\t\tparent: $(this.parent).find(\".grid-heading-row\"),\n\t\t\tparent_df: this.df,\n\t\t\tdocfields: this.docfields,\n\t\t\tfrm: this.frm,\n\t\t\tgrid: this,\n\t\t\tconfigure_columns: true,\n\t\t});\n\n\t\tthis.header_search = new GridRow({\n\t\t\tparent: $(this.parent).find(\".grid-heading-row\"),\n\t\t\tparent_df: this.df,\n\t\t\tdocfields: this.docfields,\n\t\t\tfrm: this.frm,\n\t\t\tgrid: this,\n\t\t\tshow_search: true,\n\t\t});\n\t\tthis.header_search.row.addClass(\"filter-row\");\n\t\tif (this.header_search.show_search || this.header_search.show_search_row()) {\n\t\t\t$(this.parent).find(\".grid-heading-row\").addClass(\"with-filter\");\n\t\t} else {\n\t\t\t$(this.parent).find(\".grid-heading-row\").removeClass(\"with-filter\");\n\t\t}\n\n\t\tthis.filter_applied && this.update_search_columns();\n\t}\n\n\tupdate_search_columns() {\n\t\tfor (const field in this.filter) {\n\t\t\tif (this.filter[field] && !this.header_search.search_columns[field]) {\n\t\t\t\tdelete this.filter[field];\n\t\t\t\tthis.data = this.get_data(this.filter_applied);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (this.filter[field] && this.filter[field].value) {\n\t\t\t\tlet $input = this.header_search.row_index.find(\"input\");\n\t\t\t\tif (field && field !== \"row-index\") {\n\t\t\t\t\t$input = this.header_search.search_columns[field].find(\"input\");\n\t\t\t\t}\n\t\t\t\t$input.val(this.filter[field].value);\n\t\t\t}\n\t\t}\n\t}\n\n\trefresh() {\n\t\tif (this.frm && this.frm.setting_dependency) return;\n\n\t\tthis.filter_applied = Object.keys(this.filter).length !== 0;\n\t\tthis.data = this.get_data(this.filter_applied);\n\n\t\t!this.wrapper && this.make();\n\t\tlet $rows = $(this.parent).find(\".rows\");\n\n\t\tthis.setup_fields();\n\n\t\tif (this.frm) {\n\t\t\tthis.display_status = frappe.perm.get_field_display_status(\n\t\t\t\tthis.df,\n\t\t\t\tthis.frm.doc,\n\t\t\t\tthis.perm\n\t\t\t);\n\t\t} else if (this.df.is_web_form && this.control) {\n\t\t\tthis.display_status = this.control.get_status();\n\t\t} else {\n\t\t\t// not in form\n\t\t\tthis.display_status = \"Write\";\n\t\t}\n\n\t\tif (this.display_status === \"None\") return;\n\n\t\t// redraw\n\t\tthis.make_head();\n\n\t\tif (!this.grid_rows) {\n\t\t\t/** @type {GridRow[]} */\n\t\t\tthis.grid_rows = [];\n\t\t}\n\n\t\tthis.truncate_rows();\n\t\t/** @type {Record<string, GridRow>} */\n\t\tthis.grid_rows_by_docname = {};\n\n\t\tthis.grid_pagination.update_page_numbers();\n\t\tthis.render_result_rows($rows, false);\n\t\tthis.grid_pagination.check_page_number();\n\t\tthis.wrapper.find(\".grid-empty\").toggleClass(\"hidden\", Boolean(this.data.length));\n\n\t\t// toolbar\n\t\tthis.setup_toolbar();\n\t\tthis.toggle_checkboxes(this.display_status !== \"Read\");\n\n\t\t// sortable\n\t\tif (this.is_sortable() && !this.sortable_setup_done) {\n\t\t\tthis.make_sortable($rows);\n\t\t\tthis.sortable_setup_done = true;\n\t\t}\n\n\t\tthis.last_display_status = this.display_status;\n\t\tthis.last_docname = this.frm && this.frm.docname;\n\n\t\t// red if mandatory\n\t\tthis.form_grid.toggleClass(\"error\", !!(this.df.reqd && !(this.data && this.data.length)));\n\n\t\tthis.refresh_remove_rows_button();\n\n\t\tthis.wrapper.trigger(\"change\");\n\t}\n\n\trender_result_rows($rows, append_row) {\n\t\tlet result_length = this.grid_pagination.get_result_length();\n\t\tlet page_index = this.grid_pagination.page_index;\n\t\tlet page_length = this.grid_pagination.page_length;\n\t\tif (!this.grid_rows) {\n\t\t\treturn;\n\t\t}\n\t\tfor (var ri = (page_index - 1) * page_length; ri < result_length; ri++) {\n\t\t\tvar d = this.data[ri];\n\t\t\tif (!d) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (d.idx === undefined) {\n\t\t\t\td.idx = ri + 1;\n\t\t\t}\n\t\t\tif (d.name === undefined) {\n\t\t\t\td.name = \"row \" + d.idx;\n\t\t\t}\n\t\t\tlet grid_row;\n\t\t\tif (this.grid_rows[ri] && !append_row) {\n\t\t\t\tgrid_row = this.grid_rows[ri];\n\t\t\t\tgrid_row.doc = d;\n\t\t\t\tgrid_row.refresh();\n\t\t\t} else {\n\t\t\t\tgrid_row = new GridRow({\n\t\t\t\t\tparent: $rows,\n\t\t\t\t\tparent_df: this.df,\n\t\t\t\t\tdocfields: this.docfields,\n\t\t\t\t\tdoc: d,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\tgrid: this,\n\t\t\t\t});\n\t\t\t\tthis.grid_rows[ri] = grid_row;\n\t\t\t}\n\n\t\t\tthis.grid_rows_by_docname[d.name] = grid_row;\n\t\t}\n\t}\n\n\tsetup_toolbar() {\n\t\tif (this.is_editable()) {\n\t\t\tthis.wrapper.find(\".grid-footer\").toggle(true);\n\n\t\t\t// show, hide buttons to add rows\n\t\t\tif (this.cannot_add_rows || (this.df && this.df.cannot_add_rows)) {\n\t\t\t\t// add 'hidden' to buttons\n\t\t\t\tthis.wrapper.find(\".grid-add-row, .grid-add-multiple-rows\").addClass(\"hidden\");\n\t\t\t} else {\n\t\t\t\t// show buttons\n\t\t\t\tthis.wrapper.find(\".grid-add-row\").removeClass(\"hidden\");\n\n\t\t\t\tif (this.multiple_set) {\n\t\t\t\t\tthis.wrapper.find(\".grid-add-multiple-rows\").removeClass(\"hidden\");\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (\n\t\t\tthis.grid_rows.length < this.grid_pagination.page_length &&\n\t\t\t!this.df.allow_bulk_edit\n\t\t) {\n\t\t\tthis.wrapper.find(\".grid-footer\").toggle(false);\n\t\t}\n\n\t\tthis.wrapper\n\t\t\t.find(\".grid-add-row, .grid-add-multiple-rows, .grid-upload\")\n\t\t\t.toggle(this.is_editable());\n\t}\n\n\ttruncate_rows() {\n\t\tif (this.grid_rows.length > this.data.length) {\n\t\t\t// remove extra rows\n\t\t\tfor (var i = this.data.length; i < this.grid_rows.length; i++) {\n\t\t\t\tvar grid_row = this.grid_rows[i];\n\t\t\t\tif (grid_row) grid_row.wrapper.remove();\n\t\t\t}\n\t\t\tthis.grid_rows.splice(this.data.length);\n\t\t}\n\t}\n\n\tsetup_fields() {\n\t\t// reset docfield\n\t\tif (this.frm && this.frm.docname) {\n\t\t\t// use doc specific docfield object\n\t\t\tthis.df = frappe.meta.get_docfield(\n\t\t\t\tthis.frm.doctype,\n\t\t\t\tthis.df.fieldname,\n\t\t\t\tthis.frm.docname\n\t\t\t);\n\t\t} else {\n\t\t\t// use non-doc specific docfield\n\t\t\tif (this.df.options) {\n\t\t\t\tthis.df =\n\t\t\t\t\tfrappe.meta.get_docfield(this.df.options, this.df.fieldname) ||\n\t\t\t\t\tthis.df ||\n\t\t\t\t\tnull;\n\t\t\t}\n\t\t}\n\n\t\tif (this.doctype && this.frm) {\n\t\t\tthis.docfields = frappe.meta.get_docfields(this.doctype, this.frm.docname);\n\t\t} else {\n\t\t\t// fields given in docfield\n\t\t\tthis.docfields = this.df.fields;\n\t\t}\n\n\t\tthis.docfields.forEach((df) => {\n\t\t\tthis.fields_map[df.fieldname] = df;\n\t\t});\n\t}\n\n\trefresh_row(docname) {\n\t\tthis.grid_rows_by_docname[docname] && this.grid_rows_by_docname[docname].refresh();\n\t}\n\n\tmake_sortable($rows) {\n\t\tthis.grid_sortable = new Sortable($rows.get(0), {\n\t\t\tgroup: { name: this.df.fieldname },\n\t\t\thandle: \".sortable-handle\",\n\t\t\tdraggable: \".grid-row\",\n\t\t\tanimation: 100,\n\t\t\tfilter: \"li, a\",\n\t\t\tonMove: (event) => {\n\t\t\t\t// don't move if editable\n\t\t\t\tif (!this.is_editable()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// prevent drag behaviour if _sortable property is \"false\"\n\t\t\t\tlet idx = $(event.dragged).closest(\".grid-row\").attr(\"data-idx\");\n\t\t\t\tlet doc = this.data[idx % this.grid_pagination.page_length];\n\t\t\t\tif (doc && doc._sortable === false) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonUpdate: (event) => {\n\t\t\t\tlet idx = $(event.item).closest(\".grid-row\").attr(\"data-idx\") - 1;\n\t\t\t\tlet doc = this.data[idx % this.grid_pagination.page_length];\n\t\t\t\tthis.renumber_based_on_dom();\n\t\t\t\tthis.frm &&\n\t\t\t\t\tthis.frm.script_manager.trigger(\n\t\t\t\t\t\tthis.df.fieldname + \"_move\",\n\t\t\t\t\t\tthis.df.options,\n\t\t\t\t\t\tdoc.name\n\t\t\t\t\t);\n\t\t\t\tthis.refresh();\n\t\t\t\tthis.frm && this.frm.dirty();\n\t\t\t},\n\t\t});\n\n\t\tthis.frm && $(this.frm.wrapper).trigger(\"grid-make-sortable\", [this.frm]);\n\t}\n\n\tget_data(filter_field) {\n\t\tlet data = [];\n\t\tif (filter_field) {\n\t\t\tdata = this.get_filtered_data();\n\t\t} else {\n\t\t\tdata = this.frm\n\t\t\t\t? this.frm.doc[this.df.fieldname] || []\n\t\t\t\t: this.df.data || this.get_modal_data();\n\t\t}\n\t\treturn data;\n\t}\n\n\tget_filtered_data() {\n\t\tlet all_data = this.frm ? this.frm.doc[this.df.fieldname] : this.df.data;\n\n\t\tif (!all_data) return;\n\n\t\tfor (const field in this.filter) {\n\t\t\tall_data = all_data.filter((data) => {\n\t\t\t\tlet { df, value } = this.filter[field];\n\t\t\t\treturn this.get_data_based_on_fieldtype(df, data, value.toLowerCase());\n\t\t\t});\n\t\t}\n\n\t\treturn all_data;\n\t}\n\n\tget_data_based_on_fieldtype(df, data, value) {\n\t\tlet fieldname = df.fieldname;\n\t\tlet fieldtype = df.fieldtype;\n\t\tlet fieldvalue = data[fieldname];\n\n\t\tif (fieldtype === \"Check\") {\n\t\t\tvalue = frappe.utils.string_to_boolean(value);\n\t\t\treturn Boolean(fieldvalue) === value && data;\n\t\t} else if (fieldtype === \"Sr No\" && data.idx.toString().includes(value)) {\n\t\t\treturn data;\n\t\t} else if (fieldtype === \"Duration\" && fieldvalue) {\n\t\t\tlet formatted_duration = frappe.utils.get_formatted_duration(fieldvalue);\n\n\t\t\tif (formatted_duration.includes(value)) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t} else if (fieldtype === \"Barcode\" && fieldvalue) {\n\t\t\tlet barcode = fieldvalue.startsWith(\"<svg\")\n\t\t\t\t? $(fieldvalue).attr(\"data-barcode-value\")\n\t\t\t\t: fieldvalue;\n\n\t\t\tif (barcode.toLowerCase().includes(value)) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t} else if ([\"Datetime\", \"Date\"].includes(fieldtype) && fieldvalue) {\n\t\t\tlet user_formatted_date = frappe.datetime.str_to_user(fieldvalue);\n\n\t\t\tif (user_formatted_date.includes(value)) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t} else if ([\"Currency\", \"Float\", \"Int\", \"Percent\", \"Rating\"].includes(fieldtype)) {\n\t\t\tlet num = fieldvalue || 0;\n\n\t\t\tif (fieldtype === \"Rating\") {\n\t\t\t\tlet out_of_rating = parseInt(df.options) || 5;\n\t\t\t\tnum = num * out_of_rating;\n\t\t\t}\n\n\t\t\tif (num.toString().indexOf(value) > -1) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t} else if (fieldvalue && fieldvalue.toLowerCase().includes(value)) {\n\t\t\treturn data;\n\t\t}\n\t}\n\n\tget_modal_data() {\n\t\treturn this.df.get_data\n\t\t\t? this.df.get_data().filter((data) => {\n\t\t\t\t\tif (!this.deleted_docs || !this.deleted_docs.includes(data.name)) {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t  })\n\t\t\t: [];\n\t}\n\n\tset_column_disp(fieldname, show) {\n\t\tif (Array.isArray(fieldname)) {\n\t\t\tfor (let field of fieldname) {\n\t\t\t\tthis.update_docfield_property(field, \"hidden\", show ? 0 : 1);\n\t\t\t\tthis.set_editable_grid_column_disp(field, show);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.get_docfield(fieldname).hidden = show ? 0 : 1;\n\t\t\tthis.set_editable_grid_column_disp(fieldname, show);\n\t\t}\n\n\t\tthis.debounced_refresh();\n\t}\n\n\tset_editable_grid_column_disp(fieldname, show) {\n\t\t//Hide columns for editable grids\n\t\tif (this.meta.editable_grid && this.grid_rows) {\n\t\t\tthis.grid_rows.forEach((row) => {\n\t\t\t\trow.columns_list.forEach((column) => {\n\t\t\t\t\t//Hide the column specified\n\t\t\t\t\tif (column.df.fieldname == fieldname) {\n\t\t\t\t\t\tif (show) {\n\t\t\t\t\t\t\tcolumn.df.hidden = false;\n\n\t\t\t\t\t\t\t//Show the static area and hide field area if it is not the editable row\n\t\t\t\t\t\t\tif (row != frappe.ui.form.editable_row) {\n\t\t\t\t\t\t\t\tcolumn.static_area.show();\n\t\t\t\t\t\t\t\tcolumn.field_area && column.field_area.toggle(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//Hide the static area and show field area if it is the editable row\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tcolumn.static_area.hide();\n\t\t\t\t\t\t\t\tcolumn.field_area && column.field_area.toggle(true);\n\n\t\t\t\t\t\t\t\t//Format the editable column appropriately if it is now visible\n\t\t\t\t\t\t\t\tif (column.field) {\n\t\t\t\t\t\t\t\t\tcolumn.field.refresh();\n\t\t\t\t\t\t\t\t\tif (column.field.$input)\n\t\t\t\t\t\t\t\t\t\tcolumn.field.$input.toggleClass(\"input-sm\", true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcolumn.df.hidden = true;\n\t\t\t\t\t\t\tcolumn.static_area.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.refresh();\n\t}\n\n\ttoggle_reqd(fieldname, reqd) {\n\t\tthis.update_docfield_property(fieldname, \"reqd\", reqd);\n\t\tthis.debounced_refresh();\n\t}\n\n\ttoggle_enable(fieldname, enable) {\n\t\tthis.update_docfield_property(fieldname, \"read_only\", enable ? 0 : 1);\n\t\tthis.debounced_refresh();\n\t}\n\n\ttoggle_display(fieldname, show) {\n\t\tthis.update_docfield_property(fieldname, \"hidden\", show ? 0 : 1);\n\t\tthis.debounced_refresh();\n\t}\n\n\ttoggle_checkboxes(enable) {\n\t\tthis.wrapper.find(\".grid-row-check\").prop(\"disabled\", !enable);\n\t}\n\n\tget_docfield(fieldname) {\n\t\treturn frappe.meta.get_docfield(\n\t\t\tthis.doctype,\n\t\t\tfieldname,\n\t\t\tthis.frm ? this.frm.docname : null\n\t\t);\n\t}\n\n\tget_row(key) {\n\t\tif (typeof key == \"number\") {\n\t\t\tif (key < 0) {\n\t\t\t\treturn this.grid_rows[this.grid_rows.length + key];\n\t\t\t} else {\n\t\t\t\treturn this.grid_rows[key];\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.grid_rows_by_docname[key];\n\t\t}\n\t}\n\n\tget_grid_row(key) {\n\t\treturn this.get_row(key);\n\t}\n\n\tget_field(fieldname) {\n\t\t// Note: workaround for get_query\n\t\tif (!this.fieldinfo[fieldname]) this.fieldinfo[fieldname] = {};\n\t\treturn this.fieldinfo[fieldname];\n\t}\n\n\tset_value(fieldname, value, doc) {\n\t\tif (this.display_status !== \"None\" && doc?.name && this.grid_rows_by_docname?.[doc.name]) {\n\t\t\tthis.grid_rows_by_docname[doc.name].refresh_field(fieldname, value);\n\t\t}\n\t}\n\n\tsetup_add_row() {\n\t\tthis.wrapper.find(\".grid-add-row\").click(() => {\n\t\t\tthis.add_new_row(null, null, true, null, true);\n\t\t\tthis.set_focus_on_row();\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tadd_new_row(idx, callback, show, copy_doc, go_to_last_page = false, go_to_first_page = false) {\n\t\tif (this.is_editable()) {\n\t\t\tif (go_to_last_page) {\n\t\t\t\tthis.grid_pagination.go_to_last_page_to_add_row();\n\t\t\t} else if (go_to_first_page) {\n\t\t\t\tthis.grid_pagination.go_to_page(1);\n\t\t\t}\n\n\t\t\tif (this.frm) {\n\t\t\t\tvar d = frappe.model.add_child(\n\t\t\t\t\tthis.frm.doc,\n\t\t\t\t\tthis.df.options,\n\t\t\t\t\tthis.df.fieldname,\n\t\t\t\t\tidx\n\t\t\t\t);\n\t\t\t\tif (copy_doc) {\n\t\t\t\t\td = this.duplicate_row(d, copy_doc);\n\t\t\t\t}\n\t\t\t\td.__unedited = true;\n\t\t\t\tthis.frm.script_manager.trigger(this.df.fieldname + \"_add\", d.doctype, d.name);\n\t\t\t\tthis.refresh();\n\t\t\t} else {\n\t\t\t\tif (!this.df.data) {\n\t\t\t\t\tthis.df.data = this.get_data() || [];\n\t\t\t\t}\n\t\t\t\tconst defaults = this.docfields.reduce((acc, d) => {\n\t\t\t\t\tacc[d.fieldname] = d.default;\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {});\n\n\t\t\t\tconst row_idx = this.df.data.length + 1;\n\t\t\t\tthis.df.data.push({ idx: row_idx, __islocal: true, ...defaults });\n\t\t\t\tthis.df.on_add_row && this.df.on_add_row(row_idx);\n\t\t\t\tthis.refresh();\n\t\t\t}\n\n\t\t\tif (show) {\n\t\t\t\tif (idx) {\n\t\t\t\t\t// always open inserted rows\n\t\t\t\t\tthis.wrapper\n\t\t\t\t\t\t.find(\"[data-idx='\" + idx + \"']\")\n\t\t\t\t\t\t.data(\"grid_row\")\n\t\t\t\t\t\t.toggle_view(true, callback);\n\t\t\t\t} else {\n\t\t\t\t\tif (!this.allow_on_grid_editing()) {\n\t\t\t\t\t\t// open last row only if on-grid-editing is disabled\n\t\t\t\t\t\tthis.wrapper\n\t\t\t\t\t\t\t.find(\".grid-row:last\")\n\t\t\t\t\t\t\t.data(\"grid_row\")\n\t\t\t\t\t\t\t.toggle_view(true, callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn d;\n\t\t}\n\t}\n\n\trenumber_based_on_dom() {\n\t\t// renumber based on dom\n\t\tlet $rows = $(this.parent).find(\".rows\");\n\n\t\t$rows.find(\".grid-row\").each((i, item) => {\n\t\t\tlet $item = $(item);\n\t\t\tlet index =\n\t\t\t\t(this.grid_pagination.page_index - 1) * this.grid_pagination.page_length + i;\n\t\t\tlet d = this.grid_rows_by_docname[$item.attr(\"data-name\")].doc;\n\t\t\td.idx = index + 1;\n\t\t\t$item.attr(\"data-idx\", d.idx);\n\n\t\t\tif (this.frm) this.frm.doc[this.df.fieldname][index] = d;\n\t\t\tthis.data[index] = d;\n\t\t\tthis.grid_rows[index] = this.grid_rows_by_docname[d.name];\n\t\t});\n\t}\n\n\tduplicate_row(d, copy_doc) {\n\t\tconst noCopyFields = new Set([\n\t\t\t\"creation\",\n\t\t\t\"modified\",\n\t\t\t\"modified_by\",\n\t\t\t\"idx\",\n\t\t\t\"owner\",\n\t\t\t\"parent\",\n\t\t\t\"doctype\",\n\t\t\t\"name\",\n\t\t\t\"parentfield\",\n\t\t]);\n\n\t\tconst docfields = frappe.get_meta(this.doctype).fields || [];\n\t\t$.each(docfields, function (_index, df) {\n\t\t\tif (cint(df.no_copy)) noCopyFields.add(df.fieldname);\n\t\t});\n\n\t\t$.each(copy_doc, function (key, value) {\n\t\t\tif (!noCopyFields.has(key)) {\n\t\t\t\td[key] = value;\n\t\t\t}\n\t\t});\n\n\t\treturn d;\n\t}\n\n\tset_focus_on_row(idx) {\n\t\tif (!idx && idx !== 0) {\n\t\t\tidx = this.grid_rows.length - 1;\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.grid_rows[idx].row\n\t\t\t\t.find('input[type=\"Text\"],textarea,select')\n\t\t\t\t.filter(\":visible:first\")\n\t\t\t\t.focus();\n\t\t}, 100);\n\t}\n\n\tsetup_visible_columns() {\n\t\tif (this.visible_columns && this.visible_columns.length > 0) return;\n\n\t\tthis.user_defined_columns = [];\n\t\tthis.setup_user_defined_columns();\n\t\tvar total_colsize = 1,\n\t\t\tfields =\n\t\t\t\tthis.user_defined_columns && this.user_defined_columns.length > 0\n\t\t\t\t\t? this.user_defined_columns\n\t\t\t\t\t: this.editable_fields || this.docfields;\n\n\t\tthis.visible_columns = [];\n\n\t\tfor (var ci in fields) {\n\t\t\tvar _df = fields[ci];\n\n\t\t\t// get docfield if from fieldname\n\t\t\tdf =\n\t\t\t\tthis.user_defined_columns && this.user_defined_columns.length > 0\n\t\t\t\t\t? _df\n\t\t\t\t\t: this.fields_map[_df.fieldname];\n\n\t\t\tif (\n\t\t\t\tdf &&\n\t\t\t\t!df.hidden &&\n\t\t\t\t(this.editable_fields || df.in_list_view) &&\n\t\t\t\t((this.frm && this.frm.get_perm(df.permlevel, \"read\")) || !this.frm) &&\n\t\t\t\t!frappe.model.layout_fields.includes(df.fieldtype)\n\t\t\t) {\n\t\t\t\tif (df.columns) {\n\t\t\t\t\tdf.colsize = df.columns;\n\t\t\t\t} else {\n\t\t\t\t\tthis.update_default_colsize(df);\n\t\t\t\t}\n\n\t\t\t\t// attach formatter on refresh\n\t\t\t\tif (\n\t\t\t\t\tdf.fieldtype == \"Link\" &&\n\t\t\t\t\t!df.formatter &&\n\t\t\t\t\tdf.parent &&\n\t\t\t\t\tfrappe.meta.docfield_map[df.parent]\n\t\t\t\t) {\n\t\t\t\t\tconst docfield = frappe.meta.docfield_map[df.parent][df.fieldname];\n\t\t\t\t\tif (docfield && docfield.formatter) {\n\t\t\t\t\t\tdf.formatter = docfield.formatter;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttotal_colsize += df.colsize;\n\t\t\t\tthis.visible_columns.push([df, df.colsize]);\n\t\t\t}\n\t\t}\n\n\t\t// redistribute if total-col size is less than 12\n\t\tvar passes = 0;\n\t\twhile (total_colsize < 11 && passes < 12) {\n\t\t\tfor (var i in this.visible_columns) {\n\t\t\t\tvar df = this.visible_columns[i][0];\n\t\t\t\tvar colsize = this.visible_columns[i][1];\n\t\t\t\tif (colsize > 1 && colsize < 11 && frappe.model.is_non_std_field(df.fieldname)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tpasses < 3 &&\n\t\t\t\t\t\t[\"Int\", \"Currency\", \"Float\", \"Check\", \"Percent\"].indexOf(df.fieldtype) !==\n\t\t\t\t\t\t\t-1\n\t\t\t\t\t) {\n\t\t\t\t\t\t// don't increase col size of these fields in first 3 passes\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.visible_columns[i][1] += 1;\n\t\t\t\t\ttotal_colsize++;\n\t\t\t\t}\n\n\t\t\t\tif (total_colsize > 10) break;\n\t\t\t}\n\t\t\tpasses++;\n\t\t}\n\t}\n\n\tupdate_default_colsize(df) {\n\t\tvar colsize = 2;\n\t\tswitch (df.fieldtype) {\n\t\t\tcase \"Text\":\n\t\t\t\tbreak;\n\t\t\tcase \"Small Text\":\n\t\t\t\tcolsize = 3;\n\t\t\t\tbreak;\n\t\t\tcase \"Check\":\n\t\t\t\tcolsize = 1;\n\t\t}\n\t\tdf.colsize = colsize;\n\t}\n\n\tsetup_user_defined_columns() {\n\t\tif (!this.frm) return;\n\n\t\tlet user_settings = frappe.get_user_settings(this.frm.doctype, \"GridView\");\n\t\tif (user_settings && user_settings[this.doctype] && user_settings[this.doctype].length) {\n\t\t\tthis.user_defined_columns = user_settings[this.doctype]\n\t\t\t\t.map((row) => {\n\t\t\t\t\tlet column = frappe.meta.get_docfield(this.doctype, row.fieldname);\n\n\t\t\t\t\tif (column) {\n\t\t\t\t\t\tcolumn.in_list_view = 1;\n\t\t\t\t\t\tcolumn.columns = row.columns;\n\t\t\t\t\t\treturn column;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.filter(Boolean);\n\t\t}\n\t}\n\n\tis_editable() {\n\t\treturn this.display_status == \"Write\" && !this.static_rows;\n\t}\n\n\tis_sortable() {\n\t\treturn this.sortable_status || this.is_editable();\n\t}\n\n\tonly_sortable(status) {\n\t\tif (status === undefined ? true : status) {\n\t\t\tthis.sortable_status = true;\n\t\t\tthis.static_rows = true;\n\t\t}\n\t}\n\n\tset_multiple_add(link, qty) {\n\t\tif (this.multiple_set) return;\n\n\t\tvar link_field = frappe.meta.get_docfield(this.df.options, link);\n\t\tvar btn = $(this.wrapper).find(\".grid-add-multiple-rows\");\n\n\t\t// show button\n\t\tbtn.removeClass(\"hidden\");\n\n\t\t// open link selector on click\n\t\tbtn.on(\"click\", () => {\n\t\t\tnew frappe.ui.form.LinkSelector({\n\t\t\t\tdoctype: link_field.options,\n\t\t\t\tfieldname: link,\n\t\t\t\tqty_fieldname: qty,\n\t\t\t\tget_query: link_field.get_query,\n\t\t\t\ttarget: this,\n\t\t\t\ttxt: \"\",\n\t\t\t});\n\t\t\tthis.grid_pagination.go_to_last_page_to_add_row();\n\t\t\treturn false;\n\t\t});\n\t\tthis.multiple_set = true;\n\t}\n\n\tsetup_allow_bulk_edit() {\n\t\tlet me = this;\n\t\tif (this.frm && this.frm.get_docfield(this.df.fieldname)?.allow_bulk_edit) {\n\t\t\t// download\n\t\t\tthis.setup_download();\n\n\t\t\tconst value_formatter_map = {\n\t\t\t\tDate: (val) => (val ? frappe.datetime.user_to_str(val) : val),\n\t\t\t\tInt: (val) => cint(val),\n\t\t\t\tCheck: (val) => cint(val),\n\t\t\t\tFloat: (val) => flt(val),\n\t\t\t\tCurrency: (val) => flt(val),\n\t\t\t};\n\n\t\t\t// upload\n\t\t\tfrappe.flags.no_socketio = true;\n\t\t\t$(this.wrapper)\n\t\t\t\t.find(\".grid-upload\")\n\t\t\t\t.removeClass(\"hidden\")\n\t\t\t\t.on(\"click\", () => {\n\t\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\t\tas_dataurl: true,\n\t\t\t\t\t\tallow_multiple: false,\n\t\t\t\t\t\trestrictions: {\n\t\t\t\t\t\t\tallowed_file_types: [\".csv\"],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton_success(file) {\n\t\t\t\t\t\t\tvar data = frappe.utils.csv_to_array(\n\t\t\t\t\t\t\t\tfrappe.utils.get_decoded_string(file.dataurl)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t// row #2 contains fieldnames;\n\t\t\t\t\t\t\tvar fieldnames = data[2];\n\t\t\t\t\t\t\tme.frm.clear_table(me.df.fieldname);\n\t\t\t\t\t\t\t$.each(data, (i, row) => {\n\t\t\t\t\t\t\t\tif (i > 6) {\n\t\t\t\t\t\t\t\t\tvar blank_row = true;\n\t\t\t\t\t\t\t\t\t$.each(row, function (ci, value) {\n\t\t\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\t\t\tblank_row = false;\n\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (!blank_row) {\n\t\t\t\t\t\t\t\t\t\tvar d = me.frm.add_child(me.df.fieldname);\n\t\t\t\t\t\t\t\t\t\t$.each(row, (ci, value) => {\n\t\t\t\t\t\t\t\t\t\t\tvar fieldname = fieldnames[ci];\n\t\t\t\t\t\t\t\t\t\t\tvar df = frappe.meta.get_docfield(\n\t\t\t\t\t\t\t\t\t\t\t\tme.df.options,\n\t\t\t\t\t\t\t\t\t\t\t\tfieldname\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tif (df) {\n\t\t\t\t\t\t\t\t\t\t\t\td[fieldnames[ci]] = value_formatter_map[\n\t\t\t\t\t\t\t\t\t\t\t\t\tdf.fieldtype\n\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t\t\t? value_formatter_map[df.fieldtype](value)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: value;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tme.frm.refresh_field(me.df.fieldname);\n\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\tmessage: __(\"Table updated\"),\n\t\t\t\t\t\t\t\ttitle: __(\"Success\"),\n\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t}\n\t}\n\n\tsetup_download() {\n\t\tlet title = this.df.label || frappe.model.unscrub(this.df.fieldname);\n\t\t$(this.wrapper)\n\t\t\t.find(\".grid-download\")\n\t\t\t.removeClass(\"hidden\")\n\t\t\t.on(\"click\", () => {\n\t\t\t\tvar data = [];\n\t\t\t\tvar docfields = [];\n\t\t\t\tdata.push([__(\"Bulk Edit {0}\", [title])]);\n\t\t\t\tdata.push([]);\n\t\t\t\tdata.push([]);\n\t\t\t\tdata.push([]);\n\t\t\t\tdata.push([__(\"The CSV format is case sensitive\")]);\n\t\t\t\tdata.push([__(\"Do not edit headers which are preset in the template\")]);\n\t\t\t\tdata.push([\"------\"]);\n\t\t\t\t$.each(frappe.get_meta(this.df.options).fields, (i, df) => {\n\t\t\t\t\t// don't include the read-only field in the template\n\t\t\t\t\tif (frappe.model.is_value_type(df.fieldtype)) {\n\t\t\t\t\t\tdata[1].push(df.label);\n\t\t\t\t\t\tdata[2].push(df.fieldname);\n\t\t\t\t\t\tlet description = (df.description || \"\") + \" \";\n\t\t\t\t\t\tif (df.fieldtype === \"Date\") {\n\t\t\t\t\t\t\tdescription += frappe.boot.sysdefaults.date_format;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdata[3].push(description);\n\t\t\t\t\t\tdocfields.push(df);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// add data\n\t\t\t\t$.each(this.frm.doc[this.df.fieldname] || [], (i, d) => {\n\t\t\t\t\tvar row = [];\n\t\t\t\t\t$.each(data[2], (i, fieldname) => {\n\t\t\t\t\t\tvar value = d[fieldname];\n\n\t\t\t\t\t\t// format date\n\t\t\t\t\t\tif (docfields[i].fieldtype === \"Date\" && value) {\n\t\t\t\t\t\t\tvalue = frappe.datetime.str_to_user(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trow.push(value || \"\");\n\t\t\t\t\t});\n\t\t\t\t\tdata.push(row);\n\t\t\t\t});\n\n\t\t\t\tfrappe.tools.downloadify(data, null, title);\n\t\t\t\treturn false;\n\t\t\t});\n\t}\n\n\tadd_custom_button(label, click, position = \"bottom\") {\n\t\t// add / unhide a custom button\n\t\tconst $wrapper = position === \"top\" ? this.grid_custom_buttons : this.grid_buttons;\n\t\tlet $btn = this.custom_buttons[label];\n\t\tif (!$btn) {\n\t\t\t$btn = $(`<button type=\"button\" class=\"btn btn-secondary btn-xs btn-custom\">`)\n\t\t\t\t.html(__(label))\n\t\t\t\t.prependTo($wrapper)\n\t\t\t\t.on(\"click\", click);\n\t\t\tthis.custom_buttons[label] = $btn;\n\t\t} else {\n\t\t\t$btn.removeClass(\"hidden\");\n\t\t}\n\t\treturn $btn;\n\t}\n\n\tclear_custom_buttons() {\n\t\t// hide all custom buttons\n\t\tthis.grid_buttons.find(\".btn-custom\").addClass(\"hidden\");\n\t}\n\n\tupdate_docfield_property(fieldname, property, value) {\n\t\t// update the docfield of each row\n\t\tif (!this.grid_rows) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let row of this.grid_rows) {\n\t\t\tlet docfield = row?.docfields?.find((d) => d.fieldname === fieldname);\n\t\t\tif (docfield) {\n\t\t\t\tdocfield[property] = value;\n\t\t\t} else {\n\t\t\t\tthrow `field ${fieldname} not found`;\n\t\t\t}\n\t\t}\n\n\t\t// update the parent too (for new rows)\n\t\tthis.docfields.find((d) => d.fieldname === fieldname)[property] = value;\n\n\t\tif (this.user_defined_columns && this.user_defined_columns.length > 0) {\n\t\t\tlet field = this.user_defined_columns.find((d) => d.fieldname === fieldname);\n\t\t\tif (field && Object.keys(field).includes(property)) {\n\t\t\t\tfield[property] = value;\n\t\t\t}\n\t\t}\n\n\t\tthis.debounced_refresh();\n\t}\n}", "import GridRow from './grid_row';\nimport Grid from './grid';\n\nclass Custom_GridRow extends GridRow {\n\n\tvalidate_columns_width() {\n\t\tlet total_column_width = 0.0;\n\n\t\tthis.selected_columns_for_grid.forEach((row) => {\n\t\t\tif (row.columns && row.columns > 0) {\n\t\t\t\ttotal_column_width += cint(row.columns);\n\t\t\t}\n\t\t});\n\n\t\t// if (total_column_width && total_column_width > 10) {\n\t\t// \tfrappe.throw(__(\"The total column width cannot be more than 10.\"));\n\t\t// }\n\t}\n\n\tshow_form() {\n\t\tsuper.show_form()\n\n\t\t$(this.grid.form_grid).removeClass(\"relative-important\");\n\t}\n\thide_form() {\n\t\tsuper.hide_form()\n\n\t\t$(this.grid.form_grid).addClass(\"relative-important\");\n\t}\n}\n\n\nclass Custom_Grid extends Grid {\n\n\tmake() {\n\t\tlet template = `\n\t\t\t<div class=\"grid-field\">\n\t\t\t\t<label class=\"control-label\">${__(this.df.label || \"\")}</label>\n\t\t\t\t<span class=\"help\"></span>\n\t\t\t\t<p class=\"text-muted small grid-description\"></p>\n\t\t\t\t<div class=\"grid-custom-buttons\"></div>\n\t\t\t\t<div class=\"form-grid-container enhanced-grid-container\">\n\t\t\t\t\t<div class=\"form-grid\">\n\t\t\t\t\t\t<div class=\"grid-heading-row\"></div>\n\t\t\t\t\t\t<div class=\"grid-body\">\n\t\t\t\t\t\t\t<div class=\"rows\"></div>\n\t\t\t\t\t\t\t<div class=\"grid-empty text-center\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc=\"/assets/frappe/images/ui-states/grid-empty-state.svg\"\n\t\t\t\t\t\t\t\t\talt=\"Grid Empty State\"\n\t\t\t\t\t\t\t\t\tclass=\"grid-empty-illustration\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t${__(\"No Data\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input type=\"range\" min=\"1\" max=\"100\" value=\"1\" class=\"enhanced-slider\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"small form-clickable-section grid-footer\">\n\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t<div class=\"grid-buttons\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-danger grid-remove-rows hidden\"\n\t\t\t\t\t\t\t\tdata-action=\"delete_rows\">\n\t\t\t\t\t\t\t\t${__(\"Delete\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-danger grid-remove-all-rows hidden\"\n\t\t\t\t\t\t\t\tdata-action=\"delete_all_rows\">\n\t\t\t\t\t\t\t\t${__(\"Delete All\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<!-- hack to allow firefox include this in tabs -->\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-secondary grid-add-row\">\n\t\t\t\t\t\t\t\t${__(\"Add Row\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"grid-add-multiple-rows btn btn-xs btn-secondary hidden\">\n\t\t\t\t\t\t\t\t${__(\"Add Multiple\")}</a>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"grid-pagination\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"grid-bulk-actions text-right\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"grid-download btn btn-xs btn-secondary hidden\">\n\t\t\t\t\t\t\t\t${__(\"Download\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"grid-upload btn btn-xs btn-secondary hidden\">\n\t\t\t\t\t\t\t\t${__(\"Upload\")}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.wrapper = $(template).appendTo(this.parent);\n\t\t$(this.parent).addClass(\"form-group\");\n\t\tthis.set_grid_description();\n\t\tthis.set_doc_url();\n\n\t\tfrappe.utils.bind_actions_with_object(this.wrapper, this);\n\n\t\tthis.form_grid = this.wrapper.find(\".form-grid\");\n\n\n\t\t// enhance slider changes\n\t\tthis.form_grid.addClass(\"relative-important\");\n\t\tthis.form_grid_container = this.wrapper.find(\".form-grid-container\");\n\t\tthis.enhanced_slider = this.wrapper.find(\".enhanced-slider\");\n\t\tlet me = this\n\t\tthis.enhanced_slider.on(\"input\", function (event) {\n\t\t\tconst value = event.target.value;\n\t\t\tme.form_grid.css(\"left\", `-${value}px`)\n\t\t\tme.setup_scrollable_width()\n\t\t})\n\n\n\n\n\n\t\tthis.setup_add_row();\n\n\t\tthis.setup_grid_pagination();\n\n\t\tthis.custom_buttons = {};\n\t\tthis.grid_buttons = this.wrapper.find(\".grid-buttons\");\n\t\tthis.grid_custom_buttons = this.wrapper.find(\".grid-custom-buttons\");\n\t\tthis.remove_rows_button = this.grid_buttons.find(\".grid-remove-rows\");\n\t\tthis.remove_all_rows_button = this.grid_buttons.find(\".grid-remove-all-rows\");\n\n\t\tthis.setup_allow_bulk_edit();\n\t\tthis.setup_check();\n\t\tif (this.df.on_setup) {\n\t\t\tthis.df.on_setup(this);\n\t\t}\n\n\n\t}\n\n\tmake_head() {\n\t\tif (this.prevent_build) return;\n\n\t\t// labels\n\t\tif (this.header_row) {\n\t\t\t$(this.parent).find(\".grid-heading-row .grid-row\").remove();\n\t\t}\n\t\t// implement custom class\n\t\tthis.header_row = new Custom_GridRow({\n\t\t\tparent: $(this.parent).find(\".grid-heading-row\"),\n\t\t\tparent_df: this.df,\n\t\t\tdocfields: this.docfields,\n\t\t\tfrm: this.frm,\n\t\t\tgrid: this,\n\t\t\tconfigure_columns: true,\n\t\t});\n\t\t// implement custom class\n\t\tthis.header_search = new Custom_GridRow({\n\t\t\tparent: $(this.parent).find(\".grid-heading-row\"),\n\t\t\tparent_df: this.df,\n\t\t\tdocfields: this.docfields,\n\t\t\tfrm: this.frm,\n\t\t\tgrid: this,\n\t\t\tshow_search: true,\n\t\t});\n\t\tthis.header_search.row.addClass(\"filter-row\");\n\t\tif (this.header_search.show_search || this.header_search.show_search_row()) {\n\t\t\t$(this.parent).find(\".grid-heading-row\").addClass(\"with-filter\");\n\t\t} else {\n\t\t\t$(this.parent).find(\".grid-heading-row\").removeClass(\"with-filter\");\n\t\t}\n\n\t\tthis.filter_applied && this.update_search_columns();\n\t}\n\n\trender_result_rows($rows, append_row) {\n\t\tlet result_length = this.grid_pagination.get_result_length();\n\t\tlet page_index = this.grid_pagination.page_index;\n\t\tlet page_length = this.grid_pagination.page_length;\n\t\tif (!this.grid_rows) {\n\t\t\treturn;\n\t\t}\n\t\tfor (var ri = (page_index - 1) * page_length; ri < result_length; ri++) {\n\t\t\tvar d = this.data[ri];\n\t\t\tif (!d) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (d.idx === undefined) {\n\t\t\t\td.idx = ri + 1;\n\t\t\t}\n\t\t\tif (d.name === undefined) {\n\t\t\t\td.name = \"row \" + d.idx;\n\t\t\t}\n\t\t\tlet grid_row;\n\t\t\tif (this.grid_rows[ri] && !append_row) {\n\t\t\t\tgrid_row = this.grid_rows[ri];\n\t\t\t\tgrid_row.doc = d;\n\t\t\t\tgrid_row.refresh();\n\t\t\t} else {\n\t\t\t\t// implement custom class\n\t\t\t\tgrid_row = new Custom_GridRow({\n\t\t\t\t\tparent: $rows,\n\t\t\t\t\tparent_df: this.df,\n\t\t\t\t\tdocfields: this.docfields,\n\t\t\t\t\tdoc: d,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\tgrid: this,\n\t\t\t\t});\n\t\t\t\tthis.grid_rows[ri] = grid_row;\n\t\t\t}\n\n\t\t\tthis.grid_rows_by_docname[d.name] = grid_row;\n\t\t}\n\t}\n\n\tsetup_visible_columns() {\n\t\tif (this.visible_columns && this.visible_columns.length > 0) return;\n\n\t\tthis.user_defined_columns = [];\n\t\tthis.setup_user_defined_columns();\n\t\tvar total_colsize = 1,\n\t\t\tfields =\n\t\t\t\tthis.user_defined_columns && this.user_defined_columns.length > 0\n\t\t\t\t\t? this.user_defined_columns\n\t\t\t\t\t: this.editable_fields || this.docfields;\n\n\t\tthis.visible_columns = [];\n\n\t\tfor (var ci in fields) {\n\t\t\tvar _df = fields[ci];\n\n\t\t\t// get docfield if from fieldname\n\t\t\tdf =\n\t\t\t\tthis.user_defined_columns && this.user_defined_columns.length > 0\n\t\t\t\t\t? _df\n\t\t\t\t\t: this.fields_map[_df.fieldname];\n\n\t\t\tif (\n\t\t\t\tdf &&\n\t\t\t\t!df.hidden &&\n\t\t\t\t(this.editable_fields || df.in_list_view) &&\n\t\t\t\t((this.frm && this.frm.get_perm(df.permlevel, \"read\")) || !this.frm) &&\n\t\t\t\t!frappe.model.layout_fields.includes(df.fieldtype)\n\t\t\t) {\n\t\t\t\tif (df.columns) {\n\t\t\t\t\tdf.colsize = df.columns;\n\t\t\t\t} else {\n\t\t\t\t\tthis.update_default_colsize(df);\n\t\t\t\t}\n\n\t\t\t\t// attach formatter on refresh\n\t\t\t\tif (\n\t\t\t\t\tdf.fieldtype == \"Link\" &&\n\t\t\t\t\t!df.formatter &&\n\t\t\t\t\tdf.parent &&\n\t\t\t\t\tfrappe.meta.docfield_map[df.parent]\n\t\t\t\t) {\n\t\t\t\t\tconst docfield = frappe.meta.docfield_map[df.parent][df.fieldname];\n\t\t\t\t\tif (docfield && docfield.formatter) {\n\t\t\t\t\t\tdf.formatter = docfield.formatter;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttotal_colsize += df.colsize;\n\t\t\t\tif (total_colsize > 100) return false; // Increased limit to 20\n\t\t\t\tthis.visible_columns.push([df, df.colsize]);\n\t\t\t}\n\n\t\t}\n\n\t\t// redistribute if total-col size is less than 12\n\t\tvar passes = 0;\n\t\twhile (total_colsize < 11 && passes < 12) { // Adjusted loop conditions\n\t\t\tfor (var i in this.visible_columns) {\n\t\t\t\tvar df = this.visible_columns[i][0];\n\t\t\t\tvar colsize = this.visible_columns[i][1];\n\t\t\t\tif (colsize > 1 && colsize < 11 && frappe.model.is_non_std_field(df.fieldname)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tpasses < 3 &&\n\t\t\t\t\t\t[\"Int\", \"Currency\", \"Float\", \"Check\", \"Percent\"].indexOf(df.fieldtype) !==\n\t\t\t\t\t\t-1\n\t\t\t\t\t) {\n\t\t\t\t\t\t// don't increase col size of these fields in first 3 passes\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.visible_columns[i][1] += 1;\n\t\t\t\t\ttotal_colsize++;\n\t\t\t\t}\n\n\t\t\t\tif (total_colsize > 10) break;\n\t\t\t}\n\t\t\tpasses++;\n\t\t}\n\n\t\t// set width of scrollable area\n\t\tthis.setup_scrollable_width()\n\t\tthis.verify_overflow_columns_width()\n\t}\n\n\n\tsetup_scrollable_width() {\n\t\tlet width = 200\n\t\tthis.visible_columns.forEach(column => {\n\t\t\twidth += column[1] * 50 + 100\n\t\t});\n\t\tif (width > this.form_grid_container[0].clientWidth) {\n\t\t\tthis.enhanced_slider.prop(\"max\", width - this.form_grid_container[0].clientWidth)\n\t\t\tthis.enhanced_slider.prop(\"style\", \"display:block\")\n\t\t} else {\n\t\t\tthis.form_grid.css(\"left\", `0px`)\n\t\t\tthis.enhanced_slider.prop(\"max\", this.form_grid_container[0].clientWidth)\n\t\t\tthis.enhanced_slider.prop(\"style\", \"display:none\")\n\t\t\tthis.enhanced_slider.prop(\"value\", 0)\n\t\t}\n\t}\n\n\tverify_overflow_columns_width() {\n\t\tlet width = 200\n\t\tthis.visible_columns.forEach(column => {\n\t\t\twidth += column[1] * 50 + 100\n\t\t});\n\n\t\tif (width > this.form_grid_container[0].clientWidth) {\n\t\t\tthis.form_grid_container.addClass('enhanced-grid-container')\n\t\t\tthis.enhanced_slider.prop(\"style\", \"display:block\")\n\t\t} else {\n\t\t\tthis.enhanced_slider.prop(\"style\", \"display:none\")\n\t\t\tthis.enhanced_slider.prop(\"value\", 0)\n\t\t}\n\t}\n\n}\n\n\nfrappe.ui.form.ControlTable = class CustomControlTable extends frappe.ui.form.ControlTable {\n\tmake() {\n\t\tsuper.make();\n\n\t\t// add title if prev field is not column / section heading or html\n\t\tthis.grid = new Custom_Grid({\n\t\t\tfrm: this.frm,\n\t\t\tdf: this.df,\n\t\t\tparent: this.wrapper,\n\t\t\tcontrol: this,\n\t\t});\n\n\t}\n\n\n\n}"],
  "mappings": "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",
  "names": ["GridRowForm", "opts", "me", "fieldname", "fi", "template", "$parent", "field", "first", "e", "GridRow", "opts", "me", "render_row", "e", "update", "docfields", "df", "d", "checked", "data", "index", "i", "show", "below", "duplicate", "idx", "copy_doc", "values", "refresh", "txt", "edit_msg", "row", "field", "selected_fields", "selected_column", "docfield", "fields", "blocked_fields", "always_allow", "show_field", "f", "selectedField", "selectedColumn", "column", "columns", "event", "fieldname", "selected_columns_for_grid", "value", "r", "total_colsize", "col", "ci", "colsize", "current_grid", "expression", "out", "doc", "parent", "_a", "_b", "title", "input_class", "is_disabled", "$col", "$search_input", "add_class", "grid", "grid_container", "input_in_focus", "on_input_focus", "el", "container_width", "container_left", "grid_left", "element_left", "fieldtype", "offset_right", "offset_left", "element_screen_x", "element_position_x", "handle_date_picker", "date_time_picker", "trigger_focus", "input_field", "col_df", "first_input_field", "field_on_change_function", "ignore_fieldtypes", "ESCAPE", "TAB", "UP_ARROW", "DOWN_ARROW", "ctrl_key", "move_up_down", "base", "input", "last_column", "is_last_column", "prev", "next", "is_down_arrow_key_press", "callback", "open_row", "GridRowForm", "cannot_add_rows", "row_index", "page_index", "page_length", "new_page", "blacklist", "visible_columns", "visible", "property", "set_property", "reqd", "editable", "GridPagination", "opts", "$pagination_template", "charCode", "arrow", "increment", "new_value", "total_pages", "page_text_html", "index", "from_refresh", "$rows", "page_length", "open_form", "Grid", "opts", "__publicField", "grid_body_width", "grid_scroll_bar", "grid_scroll_bar_rows", "event", "_a", "_b", "_perm", "template", "e", "isTrackpad", "delta", "scroll_bar", "touchStartX", "touchMoveX", "isTouchScrolling", "scrollBar", "deltaX", "description_wrapper", "unsupported_fieldtypes", "x", "$help", "GridPagination", "$check", "checked", "is_select_all", "docname", "result_length", "page_index", "page_length", "ri", "docname1", "docname2", "row_1", "row_2", "index_1", "index_2", "start", "end", "a", "b", "rows", "row", "dirty", "tasks", "selected_children", "doc", "index", "name", "show_delete_all_btn", "d", "GridRow", "field", "$input", "$rows", "append_row", "grid_row", "i", "df", "idx", "filter_field", "data", "all_data", "value", "fieldname", "fieldtype", "fieldvalue", "num", "out_of_rating", "show", "column", "reqd", "enable", "key", "callback", "copy_doc", "go_to_last_page", "go_to_first_page", "defaults", "acc", "row_idx", "__spreadValues", "item", "$item", "noCopyFields", "docfields", "_index", "total_colsize", "fields", "ci", "_df", "docfield", "passes", "colsize", "user_settings", "status", "link", "qty", "link_field", "btn", "me", "value_formatter_map", "val", "file", "fieldnames", "blank_row", "title", "description", "label", "click", "position", "$wrapper", "$btn", "property", "Custom_GridRow", "GridRow", "total_column_width", "row", "Custom_Grid", "Grid", "template", "me", "event", "value", "$rows", "append_row", "result_length", "page_index", "page_length", "ri", "d", "grid_row", "total_colsize", "fields", "ci", "_df", "df", "docfield", "passes", "i", "colsize", "width", "column"]
}
